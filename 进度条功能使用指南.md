# è¿›åº¦æ¡åŠŸèƒ½ä½¿ç”¨æŒ‡å—

## ğŸ“Š åŠŸèƒ½æ¦‚è¿°

`ProgressBarManager` æ˜¯é¡¹ç›®ä¸­çš„è¿›åº¦æ¡ç®¡ç†å™¨ï¼Œæä¾›äº†ä¸°å¯Œçš„å®æ—¶è¿›åº¦è·Ÿè¸ªåŠŸèƒ½ã€‚æ”¯æŒä»¥ä¸‹ç‰¹æ€§ï¼š

- â±ï¸ **å·²è¿è¡Œæ—¶é—´** - æ˜¾ç¤ºå½“å‰å·²è€—è´¹çš„æ—¶é—´ï¼ˆHH:MM:SS æ ¼å¼ï¼‰
- â³ **å‰©ä½™æ—¶é—´ä¼°ç®—** - åŸºäºå¹³å‡å¤„ç†é€Ÿåº¦ä¼°ç®—çš„å‰©ä½™æ—¶é—´
- ğŸ“ˆ **æ–‡ä»¶å¤„ç†é€Ÿåº¦** - æ¯ç§’å¤„ç†çš„æ–‡ä»¶æ•°é‡ï¼ˆæ–‡ä»¶/ç§’ï¼‰
- ğŸ“‰ **æ•°æ®å¤„ç†é€Ÿåº¦** - æ¯ç§’å¤„ç†çš„æ•°æ®é‡ï¼ˆMB/ç§’ï¼‰
- âœ“âœ— **æˆåŠŸ/å¤±è´¥ç»Ÿè®¡** - å®æ—¶ç»Ÿè®¡å·²æˆåŠŸå’Œå¤±è´¥çš„æ–‡ä»¶æ•°
- ğŸ“Š **è¿›åº¦ç™¾åˆ†æ¯”** - å®æ—¶æ˜¾ç¤ºå®Œæˆè¿›åº¦ï¼ˆ0-100%ï¼‰

## ğŸ¯ ä½¿ç”¨æ–¹å¼

### 1. åŸºç¡€åˆå§‹åŒ–

```csharp
using ImageInfo.Services;

// åˆ›å»ºè¿›åº¦æ¡ç®¡ç†å™¨ï¼Œä¼ å…¥æ€»æ–‡ä»¶æ•°
var progressManager = new ProgressBarManager(totalFiles);
```

### 2. æ›´æ–°è¿›åº¦ï¼ˆå«è¯¦ç»†ä¿¡æ¯ï¼‰

```csharp
// å¤„ç†æ¯ä¸ªæ–‡ä»¶åè°ƒç”¨ UpdateProgress
progressManager.UpdateProgress(
    currentFile: "photo.png",
    success: true,
    fileSize: 1024 * 1024  // 1MB çš„æ–‡ä»¶
);
```

**å‚æ•°è¯´æ˜ï¼š**
- `currentFile` - å½“å‰å¤„ç†çš„æ–‡ä»¶å
- `success` - æ˜¯å¦æˆåŠŸå¤„ç†ï¼ˆé»˜è®¤ trueï¼‰
- `fileSize` - æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼Œé»˜è®¤ 0ï¼‰

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
è¿›åº¦: 025% (5/20) | âœ“ 4 âœ— 1 | è€—æ—¶: 00:00:15 | å‰©ä½™: 00:00:45 | é€Ÿåº¦: 0.33 æ–‡ä»¶/ç§’ (0.52 MB/ç§’)
```

### 3. æ‰¹é‡å¤„ç†å®Œæˆåæ˜¾ç¤ºæ±‡æ€»

```csharp
progressManager.ShowSummary(successCount: 18, failureCount: 2);
```

**è¾“å‡ºç¤ºä¾‹ï¼ˆè¡¨æ ¼å½¢å¼ï¼‰ï¼š**
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    âœ“ å¤„ç†å®Œæˆ                                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ é¡¹ç›®           â”‚ å€¼                                             â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ æ€»æ–‡ä»¶æ•°       â”‚ 20                                             â•‘
â•‘ æˆåŠŸæ•°         â”‚ 18                                             â•‘
â•‘ å¤±è´¥æ•°         â”‚ 2                                              â•‘
â•‘ æˆåŠŸç‡         â”‚ 90.0%                                          â•‘
â•‘ æ€»è€—æ—¶         â”‚ 01:02:30                                       â•‘
â•‘ å·²è¿è¡Œæ—¶é—´     â”‚ 01:02:30                                       â•‘
â•‘ å¹³å‡æ–‡ä»¶é€Ÿåº¦   â”‚ 0.32 æ–‡ä»¶/ç§’                                  â•‘
â•‘ å¹³å‡æ•°æ®é€Ÿåº¦   â”‚ 0.48 MB/ç§’                                    â•‘
â•‘ æ€»å¤„ç†æ•°æ®é‡   â”‚ 30.45 MB                                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### 4. æ˜¾ç¤ºå®æ—¶è¿›åº¦é¢æ¿

```csharp
// åœ¨å¤„ç†è¿‡ç¨‹ä¸­å®šæœŸè°ƒç”¨ï¼Œæ˜¾ç¤ºè¯¦ç»†è¿›åº¦é¢æ¿
progressManager.ShowProgressPanel(currentFile: "processing_file.png");
```

**è¾“å‡ºç¤ºä¾‹ï¼ˆåŒé¢æ¿å¸ƒå±€ï¼‰ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¿›åº¦                   â”‚ æ—¶é—´ç»Ÿè®¡                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                       â”‚ ğŸ“Š processing_file.png                     â”‚
â”‚     025%              â”‚                                             â”‚
â”‚     5/20              â”‚ â±ï¸  è€—æ—¶: 00:00:15                         â”‚
â”‚     âœ“4 âœ—1             â”‚ â³ å‰©ä½™: 00:00:45                         â”‚
â”‚                       â”‚ ğŸ“ˆ é€Ÿåº¦: 0.33 æ–‡ä»¶/ç§’                    â”‚
â”‚                       â”‚ ğŸ“‰ æ•°æ®: 0.52 MB/ç§’                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5. æ˜¾ç¤º Spectre è¿›åº¦æ¡

```csharp
// ä½¿ç”¨ Spectre.Console çš„é«˜çº§è¿›åº¦æ¡æ˜¾ç¤º
progressManager.ShowSpectreProgressBar(updateCallback: (task) =>
{
    // å¯é€‰çš„å›è°ƒå‡½æ•°ï¼Œæ¯æ¬¡æ›´æ–°æ—¶è¢«è°ƒç”¨
    task.Description = $"[green]æ­£åœ¨å¤„ç†æ–‡ä»¶ {_currentIndex}/{_totalCount}[/]";
});
```

### 6. æ˜¾ç¤ºæ–‡ä»¶è¯¦æƒ…

```csharp
// å¤„ç†å•ä¸ªæ–‡ä»¶åæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
progressManager.ShowFileDetails(
    fileName: "photo.png",
    success: true,
    sourceSize: 2048 * 1024,      // 2MB
    outputSize: 512 * 1024,        // 512KB
    elapsedMs: 2500                 // 2.5 ç§’
);
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
âœ“ photo.png | 2.00 MB â†’ 0.50 MB | 75.0% å‹ç¼© | 2500ms (0.80 MB/s)
```

## ğŸ“‹ å®Œæ•´ä½¿ç”¨ç¤ºä¾‹

```csharp
using System;
using System.Collections.Generic;
using ImageInfo.Services;

public class ImageProcessingExample
{
    public static void ProcessImages(List<string> imagePaths)
    {
        var progress = new ProgressBarManager(imagePaths.Count);

        try
        {
            int successCount = 0;
            int failureCount = 0;

            foreach (var imagePath in imagePaths)
            {
                try
                {
                    progress.StartFileProcessing();
                    
                    // è¿›è¡Œå®é™…çš„å¤„ç†ï¼ˆè½¬æ¢ã€å…ƒæ•°æ®æå–ç­‰ï¼‰
                    var fileInfo = new System.IO.FileInfo(imagePath);
                    var success = ProcessImage(imagePath);
                    var elapsedMs = progress.StopFileProcessing();
                    
                    if (success)
                    {
                        successCount++;
                        progress.UpdateProgress(
                            currentFile: System.IO.Path.GetFileName(imagePath),
                            success: true,
                            fileSize: fileInfo.Length
                        );
                        
                        progress.ShowFileDetails(
                            System.IO.Path.GetFileName(imagePath),
                            success: true,
                            sourceSize: fileInfo.Length,
                            outputSize: fileInfo.Length / 2,
                            elapsedMs: elapsedMs
                        );
                    }
                    else
                    {
                        failureCount++;
                        progress.UpdateProgress(
                            currentFile: System.IO.Path.GetFileName(imagePath),
                            success: false
                        );
                    }
                }
                catch (Exception ex)
                {
                    failureCount++;
                    progress.UpdateProgress(
                        currentFile: System.IO.Path.GetFileName(imagePath),
                        success: false
                    );
                    ProgressBarManager.ShowError($"å¤„ç†å¤±è´¥: {ex.Message}");
                }

                // å®šæœŸæ˜¾ç¤ºå®æ—¶é¢æ¿ï¼ˆæ¯ 5 ä¸ªæ–‡ä»¶ä¸€æ¬¡ï¼‰
                if ((successCount + failureCount) % 5 == 0)
                {
                    progress.ShowProgressPanel(
                        imagePaths[(successCount + failureCount - 1)]
                    );
                }
            }

            // æ˜¾ç¤ºæœ€ç»ˆæ±‡æ€»
            progress.ShowSummary(successCount, failureCount);
        }
        finally
        {
            progress.Dispose();
        }
    }

    private static bool ProcessImage(string imagePath)
    {
        // å®ç°å›¾ç‰‡å¤„ç†é€»è¾‘
        return true;
    }
}
```

## ğŸ¨ è¾“å‡ºæ ·å¼

### è¿›åº¦è¡Œ (UpdateProgress è¾“å‡º)

**é¢œè‰²ç¼–ç ï¼š**
- ğŸŸ¢ **ç»¿è‰²** - è¿›åº¦æ ‡ç­¾
- ğŸŸ¡ **é»„è‰²** - ç™¾åˆ†æ¯”å’Œå…³é”®æŒ‡æ ‡
- ğŸ”µ **è“è‰²** - è€—æ—¶
- ğŸŸ£ **ç´«è‰²** - å‰©ä½™æ—¶é—´
- ğŸ”µ **é’è‰²** - å¤„ç†é€Ÿåº¦

### æ±‡æ€»è¡¨æ ¼ (ShowSummary è¾“å‡º)

**æ ·å¼ï¼š**
- åŒçº¿è¾¹æ¡†ï¼ˆ`BoxBorder.Double`ï¼‰
- ç»¿è‰²è¾¹æ¡†å’Œæ ‡é¢˜
- ä¸­å¿ƒå¯¹é½çš„è¡¨æ ¼åˆ—

### è¿›åº¦é¢æ¿ (ShowProgressPanel è¾“å‡º)

**å¸ƒå±€ï¼š**
- å·¦ä¾§é¢æ¿ï¼šè¿›åº¦ç™¾åˆ†æ¯”ã€å½“å‰è¿›åº¦ã€æˆåŠŸ/å¤±è´¥è®¡æ•°
- å³ä¾§é¢æ¿ï¼šè¿è¡Œæ—¶é—´ã€å‰©ä½™æ—¶é—´ã€æ–‡ä»¶é€Ÿåº¦ã€æ•°æ®é€Ÿåº¦
- åœ†è§’è¾¹æ¡†ï¼ˆ`BoxBorder.Rounded`ï¼‰

## âš™ï¸ é…ç½®å’Œè‡ªå®šä¹‰

### æ—¶é—´æ ¼å¼

æ‰€æœ‰æ—¶é—´é»˜è®¤æ˜¾ç¤ºä¸º `HH:MM:SS` æ ¼å¼ã€‚å¦‚éœ€ä¿®æ”¹ï¼Œå¯ç¼–è¾‘ `FormatTime()` æ–¹æ³•ï¼š

```csharp
// å½“å‰å®ç°
private static string FormatTime(TimeSpan time)
{
    return $"{time.Hours:D2}:{time.Minutes:D2}:{time.Seconds:D2}";
}
```

### é€Ÿåº¦å•ä½

- æ–‡ä»¶å¤„ç†é€Ÿåº¦ï¼šæ–‡ä»¶/ç§’
- æ•°æ®å¤„ç†é€Ÿåº¦ï¼šMB/ç§’ï¼ˆè‡ªåŠ¨ä»å­—èŠ‚è½¬æ¢ï¼‰

### å­—èŠ‚å¤§å°æ ¼å¼åŒ–

æ”¯æŒè‡ªåŠ¨å•ä½è½¬æ¢ï¼š
- **B** - å­—èŠ‚
- **KB** - åƒå­—èŠ‚ï¼ˆ1024 Bï¼‰
- **MB** - å…†å­—èŠ‚ï¼ˆ1024 KBï¼‰
- **GB** - å‰å­—èŠ‚ï¼ˆ1024 MBï¼‰

## ğŸ”§ å…³é”®æ–¹æ³•

| æ–¹æ³• | æè¿° | è¿”å›å€¼ |
|---|---|---|
| `UpdateProgress()` | æ›´æ–°è¿›åº¦ï¼Œæ˜¾ç¤ºå®æ—¶ä¿¡æ¯ | void |
| `ShowSummary()` | æ˜¾ç¤ºå¤„ç†å®Œæˆçš„æ±‡æ€»ä¿¡æ¯ | void |
| `ShowProgressPanel()` | æ˜¾ç¤ºè¯¦ç»†è¿›åº¦é¢æ¿ | void |
| `ShowFileDetails()` | æ˜¾ç¤ºå•ä¸ªæ–‡ä»¶çš„å¤„ç†è¯¦æƒ… | void |
| `ShowSpectreProgressBar()` | æ˜¾ç¤ºé«˜çº§è¿›åº¦æ¡ | void |
| `StartFileProcessing()` | å¼€å§‹è®¡æ—¶å•ä¸ªæ–‡ä»¶ | void |
| `StopFileProcessing()` | åœæ­¢è®¡æ—¶ï¼Œè¿”å›è€—æ—¶ | long |

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### è®¡ç®—æ–¹å¼

**å‰©ä½™æ—¶é—´ä¼°ç®—ï¼š**
```
å¹³å‡å¤„ç†æ—¶é—´ = æ€»è€—æ—¶ / å·²å¤„ç†æ–‡ä»¶æ•°
å‰©ä½™æ—¶é—´ = å¹³å‡å¤„ç†æ—¶é—´ Ã— å‰©ä½™æ–‡ä»¶æ•°
```

**æ–‡ä»¶å¤„ç†é€Ÿåº¦ï¼š**
```
æ–‡ä»¶é€Ÿåº¦ = å·²å¤„ç†æ–‡ä»¶æ•° / æ€»è€—æ—¶ï¼ˆç§’ï¼‰
```

**æ•°æ®å¤„ç†é€Ÿåº¦ï¼š**
```
æ•°æ®é€Ÿåº¦ = æ€»å¤„ç†å­—èŠ‚æ•° / æ€»è€—æ—¶ï¼ˆç§’ï¼‰
        = æ•°æ®é€Ÿåº¦ï¼ˆå­—èŠ‚/ç§’ï¼‰è½¬æ¢ä¸º MB/ç§’
```

## ğŸ’¡ æœ€ä½³å®è·µ

1. **åŠæ—¶è°ƒç”¨ Dispose()**
   ```csharp
   using (var progress = new ProgressBarManager(count))
   {
       // å¤„ç†æ–‡ä»¶
   } // è‡ªåŠ¨é‡Šæ”¾èµ„æº
   ```

2. **åˆç†æ›´æ–°é¢‘ç‡**
   - é¿å…æ¯ä¸ªæ–‡ä»¶éƒ½æ˜¾ç¤ºé¢æ¿ï¼Œä¼šå¯¼è‡´è¾“å‡ºè¿‡å¤š
   - å»ºè®®æ¯ 5-10 ä¸ªæ–‡ä»¶æ˜¾ç¤ºä¸€æ¬¡é¢æ¿

3. **æä¾›å‡†ç¡®çš„æ–‡ä»¶å¤§å°**
   - è¿™æ ·æ‰èƒ½å¾—åˆ°å‡†ç¡®çš„æ•°æ®å¤„ç†é€Ÿåº¦
   - ä½¿ç”¨ `FileInfo.Length` è·å–æ–‡ä»¶å¤§å°

4. **å¤„ç†å¼‚å¸¸**
   - åœ¨ catch å—ä¸­æ›´æ–°è¿›åº¦ï¼ˆæ ‡è®°ä¸ºå¤±è´¥ï¼‰
   - ä½¿ç”¨ `ProgressBarManager.ShowError()` æ˜¾ç¤ºé”™è¯¯

5. **åˆç†çš„æ—¶é—´é—´éš”**
   - é¿å…é¢‘ç¹æ›´æ–°è¿›åº¦ï¼Œå»ºè®®é—´éš” 500ms ä»¥ä¸Š
   - ç¡®ä¿ç”¨æˆ·æœ‰è¶³å¤Ÿçš„æ—¶é—´æŸ¥çœ‹è¾“å‡º

## ğŸ› æ•…éšœæ’é™¤

### è¿›åº¦è®¡ç®—ä¸å‡†ç¡®
- **åŸå› **ï¼šå¯èƒ½åœ¨æŸäº›æ–‡ä»¶å¤„ç†è¾ƒé•¿æ—¶é—´
- **è§£å†³**ï¼šå‰©ä½™æ—¶é—´ä¼°ç®—åŸºäºå¹³å‡å€¼ï¼Œå•ä¸ªæ–‡ä»¶è€—æ—¶æ³¢åŠ¨è¾ƒå¤§æ—¶ä¼šæœ‰åå·®

### é€Ÿåº¦æ˜¾ç¤ºä¸º 0
- **åŸå› **ï¼šåˆšå¼€å§‹å¤„ç†æˆ–æ€»è€—æ—¶ä¸è¶³ 1 ç§’
- **è§£å†³**ï¼šç»§ç»­å¤„ç†ï¼Œæ•°æ®ä¼šé€æ­¥æ›´æ–°

### æ•°æ®é€Ÿåº¦æ˜¾ç¤ºä¸º 0
- **åŸå› **ï¼šæœªæä¾› fileSize å‚æ•°
- **è§£å†³**ï¼šåœ¨è°ƒç”¨ `UpdateProgress()` æ—¶ä¼ å…¥ fileSize å‚æ•°

---

**æ›´æ–°æ—¥æœŸ**ï¼š2025-11-16  
**ç‰ˆæœ¬**ï¼š1.0  
**ç›¸å…³æ–‡ä»¶**ï¼š`src/ImageInfo/Services/ProgressBarManager.cs`

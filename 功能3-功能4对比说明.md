# 功能3 vs 功能4 对比说明

## 核心区别

### 功能3：自定义关键词标记（简单模式）
- **输入**：Prompt + 自定义关键词列表
- **处理方式**：直接逐行扫描，从Prompt中查找是否包含预定义的关键词
- **输出**：根据匹配到的关键词生成自定义标签（文件名标记）
- **特点**：
  - ✓ 快速简单，适合小规模文本
  - ✓ 完全基于用户预定义的关键词库
  - ✗ 固定的关键词集合，灵活性低
  - ✗ 无法发现新的高价值关键词

**使用场景**：只需标记特定的、已知的关键词组合

---

### 功能4：TF-IDF智能提取（增强模式）
- **输入**：所有Prompt文本 + TF-IDF算法
- **处理方式**：
  1. 扫描所有图片文件，收集全部Prompt
  2. 构建全局文档库（语料库）
  3. 计算IDF表（词的区分度）
  4. 对每个文件的Prompt计算TF-IDF分数
  5. 智能提取Top 10关键词
- **输出**：每个文件的Top10关键词 + TF-IDF分数（在Excel中）
- **特点**：
  - ✓ 智能自动提取最有代表性的关键词
  - ✓ 基于全局语料库计算，更有区分度
  - ✓ 无需预定义关键词库
  - ✓ 能发现每个文件最独特的词汇
  - ✗ 处理时间较长（需要扫描全部文件）

**使用场景**：发现每个文件最独特、最有代表性的特征词汇

---

## 算法原理

### TF-IDF计算公式

```
TF (词频) = 该词在文档中出现次数 / 文档总词数

IDF (逆文档频率) = log(总文档数 / 包含该词的文档数)

TF-IDF = TF × IDF
```

### 工作流程

```
第一遍扫描：收集所有Prompt
    ↓
构建文档库 + 计算IDF表
    ↓
第二遍扫描：对每个文件计算TF-IDF分数
    ↓
排序并提取Top 10关键词
    ↓
生成包含TF-IDF结果的Excel报告
```

---

## 数据流对比

### 功能3的数据流
```
图片文件1 (image1.png)
  ↓ 读取Prompt
  ↓ "beautiful girl, red dress, long hair"
  ↓ 查找预定义关键词列表
  ↓ 匹配到：girl, red, long hair
  ↓ 输出：girl|red|longhair (用于文件名标记或Excel字段)

图片文件2 (image2.png)
  ↓ 独立处理，互不影响
```

### 功能4的数据流
```
[收集阶段] 扫描所有文件
图片文件1：Prompt1 → 文本库
图片文件2：Prompt2 → 文本库
...
图片文件N：PromptN → 文本库

[计算阶段] 基于全局语料库
整个语料库 → 计算IDF表
  - 词"beautiful"在5000个文件中出现 → IDF = log(133509/5000)
  - 词"girl"在8000个文件中出现 → IDF = log(133509/8000)
  - 词"red"在3000个文件中出现 → IDF = log(133509/3000) ← 最独特

[提取阶段] 对每个文件
图片文件1：Prompt1 → TF计算 → TF-IDF分数 → Top10关键词
图片文件2：Prompt2 → TF计算 → TF-IDF分数 → Top10关键词
```

---

## Excel输出列对比

### 功能3的Excel新增列
- `自定义关键词` (来自FilenameTaggerService)
- 格式：`girl|red|longhair`（逗号或竖线分隔）
- 限制在预定义的关键词列表范围内

### 功能4的Excel新增列
- `TF-IDF关键词(Top10)` (来自TfidfProcessorService)
- 格式：`beautiful(0.82)|girl(0.76)|red(0.71)|...|dress(0.45)`
- 包含分数，帮助理解词的重要性
- 自动发现，无需预定义列表

---

## 性能对比

| 指标 | 功能3 | 功能4 |
|------|------|------|
| 单文件处理 | < 1ms | < 10ms |
| 全量数据处理 | ~5秒 | ~30秒 |
| 内存占用 | 低 (<100MB) | 中 (200-500MB) |
| 实时性 | 高（逐个扫描） | 中（需全部扫描后计算） |
| 准确性 | 中（依赖关键词库） | 高（基于统计算法） |

---

## 使用建议

### 选择功能3（自定义标记）当：
- ✓ 你有一套明确的关键词体系
- ✓ 需要快速处理和实时反馈
- ✓ 只关心特定的几个重要词汇
- ✓ 文件数量较多，性能是首要考虑

**示例**：标记"人物属性"（girl, boy, adult, child等）

---

### 选择功能4（TF-IDF）当：
- ✓ 需要发现每个文件最独特的特征词汇
- ✓ 没有预定义的关键词体系
- ✓ 想要数据驱动的分析结果
- ✓ 可以接受更长的处理时间
- ✓ 需要词汇的重要性排序（TF-IDF分数）

**示例**：分析模型差异（某个特定模型的特征词汇）、发现Prompt的高价值词汇

---

## 组合使用场景

**完整分析流程：**
1. 功能3：快速标记已知的重要属性（如人物、物体）
2. 功能4：发现新的、未预定义的高价值词汇（如艺术风格、技术参数）
3. Excel分析：对比两种结果，优化关键词体系

**例如：**
- 功能3结果：`girl|dress` (预定义关键词)
- 功能4结果：`girl(0.82)|dress(0.75)|masterpiece(0.71)|realism(0.68)|high_quality(0.65)|...` (发现新的高价值词汇)
- 发现：关键词库中应该加入"masterpiece"、"realism"、"high_quality"等艺术风格词汇

---

## 快速启动命令

```bash
# 功能3：自定义关键词标记
dotnet run -- --3

# 功能4：TF-IDF关键词提取
dotnet run -- --4
```

---

## 技术实现

### 功能3依赖
- FilenameTaggerService：关键词匹配
- FilenameParser：文件名解析
- FileScanner：文件扫描

### 功能4依赖
- TfidfProcessorService：TF-IDF计算
- FileScanner：文件扫描
- MetadataExtractors：元数据提取

---

## 总结

- **功能3** = "我想标记特定的关键词"
- **功能4** = "我想发现最有代表性的关键词"

两者互补，不是替代关系！

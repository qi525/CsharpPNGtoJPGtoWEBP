# ğŸ¯ é¡¹ç›®å¼€å‘çº²é¢†å‡†åˆ™ v1.1

**é€‚ç”¨èŒƒå›´**ï¼šä¸ªäººé¡¹ç›®è‡³å¤šäººåä½œé¡¹ç›® | **æ›´æ–°å‘¨æœŸ**ï¼šæ ¹æ®å®è·µåŠ¨æ€è°ƒæ•´  
**æ–‡æ¡£ç±»å‹**ï¼šçº²é¢†æ€§æŒ‡å¯¼ + æ£€æŸ¥æ¸…å• | **å‚è€ƒçº§åˆ«**ï¼šå›¢é˜Ÿå¿…è¯» + Code Review æ ‡å‡†  
**v1.1 æ›´æ–°**ï¼šæ·»åŠ æ—¶é—´æˆ³ä¸æ—¥å¿—è§„èŒƒã€æ–‡ä»¶æ—¶é—´æˆ³å¤„ç†ã€XLSX å•å…ƒæ ¼è¶…å¤§æ–‡æœ¬å¤„ç†

---

## ç›®å½•

1. [æ ¸å¿ƒå¼€å‘å“²å­¦](#æ ¸å¿ƒå¼€å‘å“²å­¦)
2. [é¡¹ç›®åˆ†ç±»ä¸å¤æ‚åº¦è¯„ä¼°](#é¡¹ç›®åˆ†ç±»ä¸å¤æ‚åº¦è¯„ä¼°)
3. [éœ€æ±‚é˜¶æ®µè§„èŒƒ](#éœ€æ±‚é˜¶æ®µè§„èŒƒ)
4. [æ¶æ„ä¸è®¾è®¡è§„èŒƒ](#æ¶æ„ä¸è®¾è®¡è§„èŒƒ)
5. [ç¼–ç è§„èŒƒä¸è´¨é‡æ ‡å‡†](#ç¼–ç è§„èŒƒä¸è´¨é‡æ ‡å‡†)
6. [æ–‡æ¡£ä½“ç³»å»ºè®¾](#æ–‡æ¡£ä½“ç³»å»ºè®¾)
7. [æµ‹è¯•ä¸éªŒè¯ç­–ç•¥](#æµ‹è¯•ä¸éªŒè¯ç­–ç•¥)
8. [å‡å°‘äººå·¥å¹²é¢„çš„å®è£…æŒ‡å—](#å‡å°‘äººå·¥å¹²é¢„çš„å®è£…æŒ‡å—)
9. [ä¾èµ–ç®¡ç†ä¸å®‰å…¨](#ä¾èµ–ç®¡ç†ä¸å®‰å…¨)
10. [å¤šäººåä½œæ ‡å‡†](#å¤šäººåä½œæ ‡å‡†)
11. [é¢„æµ‹æŠ¥å‘Šä¸é£é™©ç®¡ç†](#é¢„æµ‹æŠ¥å‘Šä¸é£é™©ç®¡ç†)
12. [æ—¶é—´æˆ³ä¸æ—¥å¿—è§„èŒƒ](#æ—¶é—´æˆ³ä¸æ—¥å¿—è§„èŒƒ)
13. [å‘å¸ƒä¸ç»´æŠ¤æµç¨‹](#å‘å¸ƒä¸ç»´æŠ¤æµç¨‹)
14. [æ£€æŸ¥æ¸…å•](#æ£€æŸ¥æ¸…å•)

---

## æ ¸å¿ƒå¼€å‘å“²å­¦

### åŸºæœ¬åŸåˆ™

1. **å•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰**
   - æ¯ä¸ªæ¨¡å—/ç±»/å‡½æ•°åªåšä¸€ä»¶äº‹ï¼Œåšå¥½ä¸€ä»¶äº‹
   - é¿å…èŒè´£æ··æ‚å¯¼è‡´ç»´æŠ¤å›°éš¾
   - ç¤ºä¾‹ï¼š`FileScanner` ä»…è´Ÿè´£æ‰«æï¼›å…ƒæ•°æ®æå–æ‹†åˆ†ä¸º `PngMetadataExtractor`ã€`JpegMetadataExtractor`ã€`WebPMetadataExtractor`

2. **æ ¼å¼ç‰¹åŒ–åŸåˆ™**
   - ä¸åŒçš„æ–‡ä»¶æ ¼å¼æœ‰å®Œå…¨ä¸åŒçš„å…ƒæ•°æ®å­˜å‚¨æ–¹å¼
   - PNG ä½¿ç”¨ tEXt å—ã€JPEG ä½¿ç”¨ EXIFã€WebP ä½¿ç”¨ XMP/EXIF
   - **ä¸åº”è¯¥**å°†ä¸åŒæ ¼å¼çš„å®ç°æ··åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œå³ä½¿é€»è¾‘ç›¸ä¼¼
   - å°†æ¯ä¸ªæ ¼å¼çš„å®ç°ç‹¬ç«‹ä¸ºä¸€ä¸ªä¸“åŒ–æœåŠ¡ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
   - ç¤ºä¾‹ï¼š
     ```csharp
     // âŒ ä¸æ¨èï¼šæ··åˆå®ç°
     class MetadataExtractor {
         ReadPngMetadata() { /* PNG tEXt é€»è¾‘ */ }
         ReadJpegMetadata() { /* JPEG EXIF é€»è¾‘ */ }
         ReadWebPMetadata() { /* WebP XMP é€»è¾‘ */ }
     }
     
     // âœ… æ¨èï¼šæ ¼å¼ç‰¹åŒ–
     class PngMetadataExtractor { ReadAIMetadata() { /* ä»… PNG tEXt */ } }
     class JpegMetadataExtractor { ReadAIMetadata() { /* ä»… JPEG EXIF */ } }
     class WebPMetadataExtractor { ReadAIMetadata() { /* ä»… WebP XMP */ } }
     ```

2. **æç®€ä¼˜å…ˆ**
   - ä»£ç é‡å°‘ä¸æ˜¯ç›®æ ‡ï¼Œä½†è¿‡åº¦è®¾è®¡æ˜¯æ•Œäºº
   - ä¼˜å…ˆå¯è¯»æ€§ > ä¼˜å…ˆæ€§èƒ½ï¼ˆé™¤éæœ‰æ˜ç¡®æ€§èƒ½éœ€æ±‚ï¼‰
   - æ¨¡å—å°‘ â†’ å­¦ä¹ æ›²çº¿å¹³ç¼“ â†’ ç»´æŠ¤æˆæœ¬ä½

3. **åˆ†å±‚æ¸…æ™°åŒ–**
   - æ ¸å¿ƒç¨‹åº (Program.cs) â† ç¼–æ’å±‚ (Service) â† åŸºç¡€è®¾æ–½å±‚ (Model/Utils)
   - ä¸‹å±‚ä¸ä¾èµ–ä¸Šå±‚ï¼Œä¿¡æ¯æ²¿æ ‘å‘ä¸‹æµåŠ¨
   - ç¤ºä¾‹ï¼šProgram.cs ~15 è¡Œï¼Œä»…è°ƒç”¨å…¥å£ Serviceï¼›æœåŠ¡å±‚å¤„ç†å…·ä½“é€»è¾‘

4. **è¯»-å†™-éªŒè¯ä¸‰æ­¥æ³•**ï¼ˆRead-Write-Verify Patternï¼‰
   - **è¯»**ï¼šè¯»å–æºæ•°æ®/çŠ¶æ€
   - **å†™**ï¼šè¿›è¡Œæ•°æ®å˜æ¢/æ“ä½œ
   - **éªŒè¯**ï¼šè¯»å›æ•°æ®ç¡®ä¿ä¸€è‡´æ€§
   - ä¿è¯æ•°æ®å®Œæ•´æ€§å’Œæ“ä½œå¯è¿½æº¯æ€§

5. **å¤±è´¥å³æ–‡æ¡£**
   - å¼‚å¸¸å¤„ç†ä¸æ˜¯åå’½é”™è¯¯ï¼Œè€Œæ˜¯è®°å½•ã€æŠ¥å‘Šã€å†³ç­–
   - é”™è¯¯ä¿¡æ¯åº”åŒ…å«**å‘ç”Ÿä½ç½®ã€åŸå› ã€å»ºè®®çš„æ¢å¤æ‰‹æ®µ**
   - åœ¨æŠ¥å‘Šä¸­ä¿ç•™å®Œæ•´é”™è¯¯é“¾ï¼Œä¾¿äºäº‹ååˆ†æ

6. **è‡ªåŠ¨éªŒè¯ä¸æ™ºèƒ½å‘Šè­¦**ï¼ˆå‡å°‘äººå·¥å¹²é¢„çš„æ ¸å¿ƒåŸåˆ™ï¼‰
   - **ç›®æ ‡**ï¼šå°†åŸæœ¬éœ€è¦äººå·¥ç¡®è®¤çš„æ“ä½œè½¬æ¢ä¸ºè‡ªåŠ¨éªŒè¯ï¼Œé€šè¿‡æ—¥å¿—å’Œå‘Šè­¦ç³»ç»Ÿæ±‡æŠ¥é—®é¢˜
   - **éªŒè¯æ–¹æ³•**ï¼šé‡‡ç”¨ Read-Write-Verify ä¸‰æ­¥æ³•ï¼Œåœ¨å†™å…¥åç«‹å³è¯»å›æ£€æŸ¥ä¸€è‡´æ€§
   - **å‘Šè­¦åˆ†çº§**ï¼šDEBUG/INFOï¼ˆæ­£å¸¸ä¿¡æ¯ï¼‰| WARNï¼ˆæ½œåœ¨é—®é¢˜ï¼‰| ERROR/FATALï¼ˆéœ€è¦å¤„ç†çš„æ•…éšœï¼‰
   - **æ—¥å¿—ä½œç”¨**ï¼š
     - è‡ªåŠ¨è®°å½•å…³é”®æ“ä½œå’Œå¼‚å¸¸ï¼Œæ— éœ€æ‰‹å·¥æ£€æŸ¥æ—¥å¿—
     - å®šæœŸç”Ÿæˆè¯Šæ–­æŠ¥å‘Šï¼Œè‡ªåŠ¨ç»Ÿè®¡æˆåŠŸç‡ã€å¤±è´¥åŸå› ã€æ”¹è¿›å»ºè®®
     - é—®é¢˜æ±‡æ€»åˆ°å•ä¸€æŠ¥å‘Šï¼Œé¿å…é€æ–‡ä»¶ç¿»æŸ¥
   - **è‡ªåŠ¨å¤„ç†æ¸…å•**ï¼š
     - âœ… å…ƒæ•°æ®æå–å¤±è´¥ï¼šè‡ªåŠ¨é™çº§ï¼ˆMetadataExtractor â†’ RawBytes â†’ Cacheï¼‰
     - âœ… æ–‡ä»¶è½¬æ¢éªŒè¯ï¼šå†™åè¯»å›æ£€æŸ¥å°ºå¯¸ã€æ ¼å¼ã€è´¨é‡æ˜¯å¦åŒ¹é…æºæ–‡ä»¶
     - âœ… å…ƒæ•°æ®å›å†™éªŒè¯ï¼šéªŒè¯è¾“å‡ºæ–‡ä»¶ä¸­æ˜¯å¦å­˜åœ¨å®Œæ•´çš„ FullInfo
     - âœ… æ–‡ä»¶æ—¶é—´æˆ³éªŒè¯ï¼šå†™åè¯»å›æ£€æŸ¥ä¿®æ”¹æ—¶é—´æ˜¯å¦æ­£ç¡®åº”ç”¨
     - âœ… æŠ¥å‘Šç”Ÿæˆï¼šè‡ªåŠ¨ç”Ÿæˆ XLSX + æ—¥å¿—æ–‡ä»¶ï¼Œæ— éœ€æ‰‹å·¥æ•´ç†
   - **ç¤ºä¾‹**ï¼š
     ```
     åŸå§‹æµç¨‹ï¼ˆéœ€äººå·¥å¹²é¢„ï¼‰ï¼š
     ç”¨æˆ· â†’ è¿è¡Œè½¬æ¢ â†’ æ£€æŸ¥æ§åˆ¶å°è¾“å‡º â†’ é€ä¸€æŸ¥çœ‹è¾“å‡ºæ–‡ä»¶ â†’ æ£€æŸ¥æ˜¯å¦è½¬æ¢æˆåŠŸ
     
     æ”¹è¿›æµç¨‹ï¼ˆè‡ªåŠ¨éªŒè¯ + æ™ºèƒ½å‘Šè­¦ï¼‰ï¼š
     ç”¨æˆ· â†’ è¿è¡Œè½¬æ¢ â†’ ç³»ç»Ÿè‡ªåŠ¨éªŒè¯æ¯ä¸€æ­¥ â†’ ç”Ÿæˆæ±‡æ€»æŠ¥å‘Š + è¯Šæ–­æ—¥å¿—
            â†’ ç”¨æˆ·åªéœ€æŸ¥çœ‹æŠ¥å‘Šä¸­çš„å¤±è´¥åˆ—è¡¨å’Œæ”¹è¿›å»ºè®®
     ```

---

## é¡¹ç›®åˆ†ç±»ä¸å¤æ‚åº¦è¯„ä¼°

### é¡¹ç›®ç±»å‹åˆ’åˆ†

| ç±»å‹ | ä»£ç è¡Œæ•° | æ¨¡å—æ•° | ä¾èµ–æ•° | æ–‡æ¡£éœ€æ±‚ | æµ‹è¯•è¦†ç›– | é€‚ç”¨åœºæ™¯ |
|------|--------|------|------|--------|--------|--------|
| **å¾®å‹** | < 500 | 1-2 | 0-2 | README | åŸºç¡€æµ‹è¯• | è„šæœ¬ã€ä¸€æ¬¡æ€§å·¥å…· |
| **å°å‹** | 500-2K | 2-5 | 2-5 | README + APIæ³¨é‡Š | 50%+ è¦†ç›– | å­¦ä¹ é¡¹ç›®ã€å†…éƒ¨å·¥å…· |
| **ä¸­å‹** | 2K-10K | 5-15 | 5-10 | README + æ¶æ„æ–‡æ¡£ + éš¾åº¦è¡¨ | 70%+ è¦†ç›– | ç”Ÿäº§çº§å·¥å…·ï¼ˆå¦‚æœ¬é¡¹ç›®ï¼‰ |
| **å¤§å‹** | 10K-50K | 15-50 | 10-30 | å®Œæ•´æ–‡æ¡£ä½“ç³» + RFD + é¢„æµ‹æŠ¥å‘Š | 80%+ è¦†ç›– | ä¼ä¸šåº”ç”¨ã€æ¡†æ¶ |
| **è¶…å¤§å‹** | 50K+ | 50+ | 30+ | å¤šç»´æ–‡æ¡£ + æ¶æ„å†³ç­–è®°å½• + æ€§èƒ½/å®‰å…¨æŠ¥å‘Š | 85%+ è¦†ç›– | ç³»ç»Ÿçº§è½¯ä»¶ |

### å¤æ‚åº¦å¤šç»´åº¦è¯„ä¼°

é¡¹ç›®å¤æ‚åº¦ = å¤šç»´è¯„åˆ†ç»¼åˆ

```
æ€»ä½“å¤æ‚åº¦æŒ‡æ•° (CCI) = (ä»£ç å¤æ‚åº¦ Ã— 0.2) 
                      + (ä¾èµ–å¤æ‚åº¦ Ã— 0.2) 
                      + (æ¶æ„å¤æ‚åº¦ Ã— 0.25) 
                      + (ç»´æŠ¤éš¾åº¦ Ã— 0.15) 
                      + (é£é™©ç¨‹åº¦ Ã— 0.2)

CCI âˆˆ [0, 100]ï¼š
  0-20   â†’ æä½é£é™©ï¼ˆè„šæœ¬çº§ï¼‰
  20-40  â†’ ä½é£é™©ï¼ˆå­¦ä¹ é¡¹ç›®ï¼‰
  40-60  â†’ ä¸­ç­‰é£é™©ï¼ˆç”Ÿäº§å·¥å…·ï¼‰
  60-80  â†’ é«˜é£é™©ï¼ˆä¼ä¸šåº”ç”¨ï¼‰
  80-100 â†’ æé«˜é£é™©ï¼ˆæ ¸å¿ƒç³»ç»Ÿï¼‰
```

#### ä»£ç å¤æ‚åº¦ (CC)
- **åº¦é‡**ï¼šåœˆå¤æ‚åº¦ (Cyclomatic Complexity) + å‡½æ•°æ•°é‡ + åµŒå¥—æ·±åº¦
- **è¯„çº§**ï¼š
  - CC < 50ï¼šæä½
  - 50 â‰¤ CC < 150ï¼šä½
  - 150 â‰¤ CC < 300ï¼šä¸­ç­‰
  - 300 â‰¤ CC < 500ï¼šé«˜
  - CC â‰¥ 500ï¼šæé«˜

#### ä¾èµ–å¤æ‚åº¦ (DC)
- **è¯„ä¼°ç»´åº¦**ï¼šä¾èµ–æ•°é‡ã€ä¾èµ–ç‰ˆæœ¬ç¨³å®šæ€§ã€å·²çŸ¥æ¼æ´æ•°ã€ç¤¾åŒºæ´»è·ƒåº¦
- **è¯„çº§**ï¼š
  - æ— å¤–éƒ¨ä¾èµ–æˆ–å…¨å®˜æ–¹åº“ï¼šæä½
  - 1-3 æˆç†Ÿåº“ï¼ˆå¦‚ xUnitã€SixLabors.ImageSharpï¼‰ï¼šä½
  - 4-8 æ··åˆåº“ï¼ˆå®˜æ–¹ + ç¬¬ä¸‰æ–¹ï¼‰ï¼šä¸­ç­‰
  - 8+ æ·±åº¦ä¾èµ–æ ‘æˆ–å®éªŒæ€§åº“ï¼šé«˜
  - åŒ…å«å·²çŸ¥é«˜å±æ¼æ´åº“ï¼šæé«˜

#### æ¶æ„å¤æ‚åº¦ (AC)
- **è¯„ä¼°ç»´åº¦**ï¼šåˆ†å±‚æ•°ã€æ¨¡å—é—´è€¦åˆã€æ•°æ®æµæ¸…æ™°åº¦
- **è¯„çº§**ï¼š
  - å•æ–‡ä»¶è„šæœ¬ï¼šæä½
  - 2-3 å±‚ (Model / Service / UI)ï¼šä½
  - 3-5 å±‚ (å« Repository / Middleware)ï¼šä¸­ç­‰
  - 5+ å±‚æˆ–å¾ªç¯ä¾èµ–ï¼šé«˜
  - å¾®æœåŠ¡ / åˆ†å¸ƒå¼ / äº‹ä»¶é©±åŠ¨ï¼šæé«˜

#### ç»´æŠ¤éš¾åº¦ (MM)
- **è¯„ä¼°ç»´åº¦**ï¼šæ–‡æ¡£å®Œæ•´åº¦ã€ä»£ç å¯è¯»æ€§ã€æµ‹è¯•è¦†ç›–ç‡ã€æŠ€æœ¯æ ˆç†Ÿæ‚‰åº¦
- **è¯„çº§**ï¼š
  - æ–‡æ¡£é½å…¨ + é«˜è¦†ç›–æµ‹è¯• + å¸¸è§æŠ€æœ¯æ ˆï¼šæä½
  - æœ‰åŸºç¡€æ–‡æ¡£ + ä¸­ç­‰è¦†ç›– + ä¸»æµæŠ€æœ¯æ ˆï¼šä½
  - æ–‡æ¡£ç¼ºå¤±æˆ–ä¸æ¸… + ä½è¦†ç›–ï¼šä¸­ç­‰
  - æ— æ–‡æ¡£ + ä¾èµ–å¤±æ•ˆ + æ™¦æ¶©æŠ€æœ¯æ ˆï¼šé«˜
  - ä»£ç æ··ä¹±æ— æ–‡æ¡£ + æŠ€æœ¯å€ºç§¯é‡éš¾è¿”ï¼šæé«˜

#### é£é™©ç¨‹åº¦ (RP)
- **è¯„ä¼°ç»´åº¦**ï¼šæ•°æ®å®‰å…¨ã€ç³»ç»Ÿå¯ç”¨æ€§ã€ç”¨æˆ·éšç§ã€æ¢å¤éš¾åº¦
- **è¯„çº§**ï¼š
  - æœ¬åœ°å·¥å…·ã€æ— æ•æ„Ÿæ•°æ®ï¼šæä½
  - å¤„ç†ç”¨æˆ·ä¿¡æ¯ä½†æ— å¯¹å¤–æš´éœ²ï¼šä½
  - å¤„ç†æ•æ„Ÿä¸šåŠ¡æ•°æ®æˆ–æœ‰ç½‘ç»œæ¥å£ï¼šä¸­ç­‰
  - å¤„ç†æ”¯ä»˜ã€åŒ»ç–—æˆ–ä¸ªäººéšç§æ•°æ®ï¼šé«˜
  - ç”Ÿå‘½å®‰å…¨ç³»ç»Ÿæˆ–é‡‘èæ ¸å¿ƒç³»ç»Ÿï¼šæé«˜

---

## éœ€æ±‚é˜¶æ®µè§„èŒƒ

### éœ€æ±‚æ”¶é›†ä¸åˆ†æ

**å…¥å£æ–‡æ¡£**ï¼šéœ€æ±‚æè¿°æ–‡æ¡£ (RDD) æˆ–ç”¨æˆ·æ•…äº‹ (User Story)

**RDD æ¨¡æ¿**ï¼š
```
## éœ€æ±‚æ ‡é¢˜
[æ¸…æ™°çš„åŠŸèƒ½åç§°]

## éœ€æ±‚åˆ†ç±»
- åŠŸèƒ½éœ€æ±‚ / éåŠŸèƒ½éœ€æ±‚ / çº¦æŸéœ€æ±‚

## ä¸šåŠ¡èƒŒæ™¯
[ä¸ºä»€ä¹ˆè¦åšè¿™ä¸ª]

## è¯¦ç»†æè¿°
- ç”¨æˆ·è§’è‰²ï¼š[è°ä½¿ç”¨]
- è¾“å…¥ï¼š[æ¥æ”¶ä»€ä¹ˆ]
- è¾“å‡ºï¼š[äº§å‡ºä»€ä¹ˆ]
- çº¦æŸæ¡ä»¶ï¼š[ç¯å¢ƒã€æ€§èƒ½ã€å…¼å®¹æ€§]

## éªŒæ”¶æ ‡å‡†
- [ ] æ¡ä»¶ 1
- [ ] æ¡ä»¶ 2
- [ ] æ¡ä»¶ 3

## ä¼˜å…ˆçº§ä¸å½±å“èŒƒå›´
- ä¼˜å…ˆçº§ï¼šP0(å¿…é¡») / P1(é‡è¦) / P2(å¯é€‰)
- å½±å“èŒƒå›´ï¼šå“ªäº›æ¨¡å—/ç”¨æˆ·

## å…³é”®é£é™©ä¸å‡è®¾
- é£é™© 1ï¼š...ï¼ˆç¼“è§£æ–¹æ¡ˆï¼‰
- å‡è®¾ 1ï¼š...ï¼ˆéªŒè¯æ–¹æ³•ï¼‰
```

### éœ€æ±‚è§„èŒƒåŒ–æ£€æŸ¥æ¸…å•

- [ ] éœ€æ±‚æ˜¯å¦å¯éªŒè¯ï¼Ÿï¼ˆèƒ½å¦å®šé‡æˆ–å®šæ€§åœ°ç¡®è®¤å®Œæˆï¼‰
- [ ] éœ€æ±‚æ˜¯å¦å¯è¿½æº¯ï¼Ÿï¼ˆèƒ½å¦åå‘æ˜ å°„åˆ°ç”¨æˆ·æ•…äº‹ï¼‰
- [ ] éœ€æ±‚ä¹‹é—´æ˜¯å¦æœ‰å†²çªï¼Ÿï¼ˆéœ€æ±‚å…¼å®¹æ€§åˆ†æï¼‰
- [ ] æ˜¯å¦è¯†åˆ«å‡ºäº†éšæ€§éœ€æ±‚ï¼Ÿï¼ˆå¦‚å®‰å…¨ã€å¯ç”¨æ€§ã€å¯ç»´æŠ¤æ€§ï¼‰
- [ ] éœ€æ±‚æ˜¯å¦è¢«åˆ†è§£ä¸ºå¯å®ç°çš„å·¥ä½œé¡¹ï¼Ÿï¼ˆæ•…äº‹ç‚¹è¯„ä¼°ï¼‰

---

## æ¶æ„ä¸è®¾è®¡è§„èŒƒ

### æ¶æ„è®¾è®¡æ–‡æ¡£ (ADD - Architecture Design Document)

æ¯ä¸ªä¸­å‹ä»¥ä¸Šé¡¹ç›®å¿…é¡»äº§å‡º ADDï¼ŒåŒ…å«ï¼š

1. **ç³»ç»Ÿæ„¿æ™¯**
   - é¡¹ç›®ç›®æ ‡ã€ä½œç”¨èŒƒå›´ã€ä½¿ç”¨åœºæ™¯
   - ä¸å…¶ä»–ç³»ç»Ÿçš„äº¤äº’å…³ç³»

2. **æ¶æ„è§†å›¾**
   ```
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  è¡¨ç°å±‚ / å…¥å£ç‚¹                      â”‚  (Program.cs)
   â”‚  â”œâ”€ CLI / GUI / API                  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  ä¸šåŠ¡é€»è¾‘å±‚                          â”‚  (Services)
   â”‚  â”œâ”€ ConversionService               â”‚
   â”‚  â”œâ”€ MetadataService                 â”‚
   â”‚  â”œâ”€ AIMetadataExtractor             â”‚
   â”‚  â”œâ”€ FileTimeService                 â”‚
   â”‚  â””â”€ ValidationService               â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  åŸºç¡€è®¾æ–½å±‚                          â”‚  (Models / Utils)
   â”‚  â”œâ”€ Models (ConversionReportRow)    â”‚
   â”‚  â”œâ”€ System.IO (æ–‡ä»¶æ“ä½œ)            â”‚
   â”‚  â””â”€ ç¬¬ä¸‰æ–¹åº“ (ImageSharp, etc)     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   ```

3. **å…³é”®è®¾è®¡å†³ç­–**
   - ä¸ºä»€ä¹ˆé€‰æ‹©è¯¥æ¶æ„ï¼Ÿ
   - å€™é€‰æ–¹æ¡ˆä¸æƒè¡¡åˆ†æ
   - ç¤ºä¾‹ï¼š
     ```
     å†³ç­–ï¼šä½¿ç”¨ SixLabors.ImageSharp ä»£æ›¿ Magick.NET
     åŸå› ï¼šæ¶ˆé™¤é«˜å±æ¼æ´ï¼Œé™ä½ä¾èµ–é£é™©
     æƒè¡¡ï¼šImageSharp ä¸åŸç”Ÿæ”¯æŒ WebP â†’ æ”¹ç”¨ SkiaSharp
     æˆæœ¬ï¼š2h é‡æ„ + æµ‹è¯•
     æ”¶ç›Šï¼šå®‰å…¨æ€§ â†‘ï¼Œä¾èµ–å¤æ‚åº¦ â†“
     ```

4. **æ•°æ®æµä¸äº¤äº’**
   - å…³é”®æ•°æ®æµç¨‹å›¾ï¼ˆRead-Write-Verify æµç¨‹ï¼‰
   - æ¨¡å—é—´çš„æ¥å£å¥‘çº¦
   - å¼‚å¸¸ä¸é”™è¯¯å¤„ç†æµ

5. **æŠ€æœ¯æ ˆä¸ä¾èµ–å†³ç­–**
   - ä¸ºä»€ä¹ˆé€‰æ‹©è¯¥è¯­è¨€/æ¡†æ¶ï¼Ÿ
   - ä¾èµ–ç‰ˆæœ¬é”å®šä¸ç»´æŠ¤ç­–ç•¥
   - å…¼å®¹æ€§ä¸æ”¯æŒå‘¨æœŸè¯„ä¼°

### æ¨¡å—è®¾è®¡è§„èŒƒ

**æ¯ä¸ªæ¨¡å—åº”åŒ…å«**ï¼š

1. **èŒè´£å£°æ˜**
   ```
   /// <summary>
   /// FileScanner è´Ÿè´£æ–‡ä»¶ç³»ç»Ÿæ‰«æä¸å›¾ç‰‡æ–‡ä»¶æšä¸¾
   /// èŒè´£èŒƒå›´ï¼šé€’å½’éå†ç›®å½•ã€æŒ‰æ‰©å±•åè¿‡æ»¤
   /// ä¸è´Ÿè´£ï¼šå…ƒæ•°æ®æå–ã€æ–‡ä»¶å†…å®¹éªŒè¯
   /// </summary>
   public static class FileScanner { }
   ```

2. **å…¬å¼€æ¥å£æ¸…å•**
   ```
   public static IEnumerable<string> GetImageFiles(string root)
   // è¾“å…¥ï¼šç›®å½•è·¯å¾„
   // è¾“å‡ºï¼šå›¾ç‰‡æ–‡ä»¶å®Œæ•´è·¯å¾„åˆ—è¡¨
   // å¼‚å¸¸ï¼šDirectoryNotFoundException, UnauthorizedAccessException
   ```

3. **ä¾èµ–æ¸…å•**
   - å®˜æ–¹åº“ï¼šSystem.IO, System.Linq
   - ç¬¬ä¸‰æ–¹åº“ï¼šï¼ˆæ— ï¼‰
   - å…¶ä»–æ¨¡å—ï¼šï¼ˆæ— ï¼‰

4. **æµ‹è¯•è¦†ç›–**
   - å•å…ƒæµ‹è¯•ï¼š{ModuleName}Tests.cs
   - è¦†ç›–ç‡ç›®æ ‡ï¼š70% ä»¥ä¸Š

### é¡¹ç›®ç›®å½•ç»“æ„è§„èŒƒ

å‚è§ç‹¬ç«‹æ–‡æ¡£ï¼š**é¡¹ç›®ç›®å½•ç»“æ„è§„åˆ’.md**

**å¿«é€ŸæŒ‡å—**ï¼š

| æ–‡ä»¶å¤¹ | èŒè´£ | ç¤ºä¾‹ |
|--------|------|------|
| **Models/** | æ•°æ®æ¨¡å‹ã€å®ä½“ã€DTO | `ConversionReportRow.cs` |
| **Services/** | ä¸šåŠ¡é€»è¾‘ã€å·¥å…·æ–¹æ³• | `ConversionService.cs` |
| **bin/** | ç¼–è¯‘è¾“å‡ºï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰ | æ— éœ€ç»´æŠ¤ |
| **obj/** | ä¸­é—´ç¼–è¯‘æ–‡ä»¶ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰ | æ— éœ€ç»´æŠ¤ |

**è®¾è®¡åŸåˆ™**ï¼š
- Models ä»…åŒ…å«æ•°æ®ç»“æ„å’Œå±æ€§ï¼Œä¸åŒ…å«ä¸šåŠ¡é€»è¾‘
- Services å®ç°ä¸šåŠ¡é€»è¾‘ï¼Œæ— éœ€å¤„ç† UI æˆ– HTTP è¯·æ±‚
- ç›¸å…³çš„ç±»æ”¾åœ¨åŒä¸€æ–‡ä»¶å¤¹ï¼Œä¾¿äºå¯¼èˆª
- å½“æ–‡ä»¶ > 100 æ—¶ï¼Œè€ƒè™‘æŒ‰åŠŸèƒ½åŸŸè¿›ä¸€æ­¥ç»†åˆ†

**ä½ çš„é¡¹ç›®ç»“æ„**ï¼ˆä¸­å‹é¡¹ç›®ç¤ºèŒƒï¼‰ï¼š
```
src/ImageInfo/
â”œâ”€â”€ Models/           â† 4 ä¸ªæ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ ConversionReportRow.cs
â”‚   â”œâ”€â”€ ImageInfoModel.cs
â”‚   â”œâ”€â”€ AIMetadata.cs
â”‚   â””â”€â”€ OutputDirectoryMode.cs
â”œâ”€â”€ Services/         â† 13+ ä¸ªä¸šåŠ¡æœåŠ¡
â”‚   â”œâ”€â”€ ConversionService.cs
â”‚   â”œâ”€â”€ ReportService.cs
â”‚   â”œâ”€â”€ ImageConverter.cs
â”‚   â”œâ”€â”€ FileTimeService.cs
â”‚   â””â”€â”€ ... å…¶ä»–æœåŠ¡
â””â”€â”€ Program.cs
```

---

## ç¼–ç è§„èŒƒä¸è´¨é‡æ ‡å‡†

### å‘½åçº¦å®š

| å…ƒç´  | æ ¼å¼ | ç¤ºä¾‹ | è¯´æ˜ |
|-----|------|------|------|
| å‘½åç©ºé—´ | PascalCase | `ImageInfo.Services` | åæ˜ ç»„ç»‡ç»“æ„ |
| ç±»/æ¥å£ | PascalCase | `ImageConverter`, `IValidator` | æ¥å£å¸¦ I å‰ç¼€ï¼›åº“æ¥æºæ ‡è®°åœ¨æ–‡æ¡£è¡¨ä¸­ |
| æ–¹æ³• | PascalCase | `ConvertPngToJpeg()` | åŠ¨è¯ä¼˜å…ˆ |
| å‚æ•° | camelCase | `sourcePath`, `quality` | å°å†™å¼€å¤´ |
| å¸¸é‡ | UPPER_SNAKE_CASE | `MAX_IMAGE_SIZE` | å…¨å¤§å†™ä¸‹åˆ’çº¿åˆ†éš” |
| æœ¬åœ°å˜é‡ | camelCase | `result`, `imageInfo` | å°å†™å¼€å¤´ |
| ç§æœ‰å­—æ®µ | _camelCase | `_imageCache` | ä¸‹åˆ’çº¿ + camelCase |
| å±æ€§ | PascalCase | `FilePath`, `Tags` | åŒç±»å‘½å |
| åº“æ¥æºæ ‡è®° | XML æ³¨é‡Š | `/// ä½¿ç”¨ SixLabors.ImageSharp` | å®˜æ–¹/ç¬¬ä¸‰æ–¹/è‡ªå†™ |

### ä»£ç æ·±åº¦ä¸å¤æ‚åº¦é™åˆ¶

**åŸºæœ¬è§„åˆ™**ï¼š
- å‡½æ•°è¡Œæ•°ï¼šâ‰¤ 50 è¡Œï¼ˆä¸å«æ³¨é‡Šï¼‰
- æ¡ä»¶åµŒå¥—æ·±åº¦ï¼šâ‰¤ 3 å±‚ï¼ˆif/for/while æœ€å¤š 3 å±‚ï¼‰
- å‚æ•°æ•°é‡ï¼šâ‰¤ 4 ä¸ªï¼ˆè¶…è¿‡ 4 ä¸ªï¼Œè€ƒè™‘ä½¿ç”¨å¯¹è±¡æˆ–å¯é€‰å‚æ•°ï¼‰
- åœˆå¤æ‚åº¦ï¼ˆCCï¼‰ï¼šâ‰¤ 10ï¼ˆå•ä¸ªå‡½æ•°ï¼‰
- ç±»çš„æ–¹æ³•æ•°ï¼šâ‰¤ 15 ä¸ªï¼ˆè¶…è¿‡ 15ï¼Œè€ƒè™‘æ‹†åˆ†ï¼‰

**è¿åæ—¶çš„å¤„ç†**ï¼š
```csharp
// âŒ ä¸è‰¯ï¼šè¿‡åº¦å¤æ‚
public bool ProcessImage(string path, int quality, bool preserveAlpha, 
                         string format, int width, int height, 
                         bool autoScale, string output)
{
    if (!File.Exists(path)) return false;
    var img = Image.Load(path);
    if (preserveAlpha)
    {
        if (format == "jpg")
        {
            // ... å¤„ç†é€æ˜åº¦
        }
        else if (format == "webp")
        {
            // ... å¦ä¸€å¥—å¤„ç†
        }
    }
    // ... 30+ è¡Œä»£ç 
}

// âœ… è‰¯å¥½ï¼šæ‹†åˆ†ä¸ºå¤šä¸ªå°å‡½æ•°
public bool ProcessImage(ImageProcessOptions options)
{
    var image = LoadImage(options.Path);
    if (image == null) return false;
    
    var processed = ApplyPreprocessing(image, options);
    return SaveImage(processed, options.Output, options.Format);
}

private Image ApplyPreprocessing(Image img, ImageProcessOptions opts)
{
    return opts.PreserveAlpha 
        ? HandleAlphaChannel(img, opts.Format) 
        : img;
}
```

### å¼‚å¸¸å¤„ç†è§„èŒƒ

**åŸåˆ™**ï¼š
1. **ä¸ä½¿ç”¨å¼‚å¸¸åšæ§åˆ¶æµ**ï¼ˆå¦‚ try-catch ä»£æ›¿ if-elseï¼‰
2. **æ•è·å…·ä½“å¼‚å¸¸**ï¼Œä¸ç”¨è£¸ `catch (Exception)`
3. **å¼‚å¸¸å¿…é¡»å¸¦ä¸Šä¸‹æ–‡ä¿¡æ¯**
4. **å…³é”®æ“ä½œéœ€è®°å½•æ—¥å¿—**

**ç¤ºä¾‹**ï¼š
```csharp
// âŒ ä¸è‰¯
try
{
    return Image.Load(path);
}
catch (Exception)
{
    return null;  // åå’½å¼‚å¸¸ï¼Œæ— æ³•è¯Šæ–­
}

// âœ… è‰¯å¥½
public Image? TryLoadImage(string path)
{
    try
    {
        if (!File.Exists(path))
            throw new FileNotFoundException($"Image not found: {path}");
        
        return Image.Load(path);
    }
    catch (FileNotFoundException ex)
    {
        Logger.Warn($"Failed to load image at {path}: {ex.Message}");
        return null;
    }
    catch (UnknownImageFormatException ex)
    {
        Logger.Error($"Unsupported image format at {path}: {ex.Message}");
        throw new InvalidOperationException($"Cannot process {path}", ex);
    }
    catch (OutOfMemoryException ex)
    {
        Logger.Fatal($"Out of memory loading {path}: {ex.Message}");
        throw;
    }
}
```

### XML æ–‡æ¡£æ³¨é‡Šè§„èŒƒ

æ¯ä¸ªå…¬å¼€ç±»/æ–¹æ³•å¿…é¡»åŒ…å« XML æ³¨é‡Šï¼š

```csharp
/// <summary>
/// å°† PNG è½¬æ¢ä¸º JPEG æ ¼å¼ï¼Œç™½è‰²æ›¿ä»£é€æ˜èƒŒæ™¯ã€‚
/// </summary>
/// <remarks>
/// è¯¥æ–¹æ³•ä½¿ç”¨ SixLabors.ImageSharp è¿›è¡Œè½¬æ¢ã€‚
/// è´¨é‡å‚æ•°èŒƒå›´ [1, 100]ï¼Œæ¨èå€¼ 85ã€‚
/// </remarks>
/// <param name="pngPath">æº PNG æ–‡ä»¶è·¯å¾„</param>
/// <param name="outPath">è¾“å‡º JPEG è·¯å¾„ï¼ˆå¯é€‰ï¼Œé»˜è®¤åŒç›®å½•åŒåï¼‰</param>
/// <param name="quality">JPEG è´¨é‡å‚æ•° [1-100]ï¼Œé»˜è®¤ 85</param>
/// <returns>è¾“å‡ºæ–‡ä»¶çš„å®Œæ•´è·¯å¾„</returns>
/// <exception cref="FileNotFoundException">æºæ–‡ä»¶ä¸å­˜åœ¨</exception>
/// <exception cref="InvalidOperationException">æ ¼å¼ä¸å—æ”¯æŒæˆ–è½¬æ¢å¤±è´¥</exception>
/// <example>
/// <code>
/// var outPath = ImageConverter.ConvertPngToJpeg("input.png", quality: 90);
/// Console.WriteLine($"Converted to: {outPath}");
/// </code>
/// </example>
public static string ConvertPngToJpeg(string pngPath, string? outPath = null, int quality = 85)
{
    // å®ç°
}
```

### SOLID åŸåˆ™æ£€æŸ¥

| åŸåˆ™ | æ£€æŸ¥é¡¹ | æœ¬é¡¹ç›®ç¤ºä¾‹ |
|-----|------|---------|
| **S** (Single) | ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå˜åŒ–åŸå›  | FileScanner ä»…è´Ÿè´£æ‰«æï¼›å…ƒæ•°æ®æå–äº¤ç»™ MetadataService |
| **O** (Open) | å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ | æ·»åŠ æ–°è½¬æ¢æ ¼å¼æ—¶ï¼Œæ‰©å±• ImageConverter è€Œéä¿®æ”¹ç°æœ‰ä»£ç  |
| **L** (Liskov) | å­ç±»å¯æ›¿ä»£çˆ¶ç±» | è‹¥ä½¿ç”¨æ¥å£ IImageConverterï¼Œæ‰€æœ‰å®ç°å¿…é¡»éµå¾ªç›¸åŒå¥‘çº¦ |
| **I** (Interface) | æ¥å£ç»†åˆ†ï¼Œé¿å…"æ±¡æŸ“" | ä¸åº”æœ‰åŒ…å« 20+ æ–¹æ³•çš„å·¨å¤§æ¥å£ |
| **D** (Dependency) | ä¾èµ–æŠ½è±¡è€Œéå…·ä½“ | å¦‚éœ€å¤šç§å…ƒæ•°æ®æºï¼Œå®šä¹‰ IMetadataReader æ¥å£ |

---

## TODO ç®¡ç†è§„èŒƒï¼ˆä»æƒ³æ³•åˆ°ä»£ç å®ç°çš„ä¼˜åŒ–è¿‡ç¨‹ï¼‰

é¡¹ç›®å¼€å‘çš„æ¯ä¸ªé˜¶æ®µéƒ½åº”è¯¥é€šè¿‡ TODO åˆ—è¡¨æ¥è§„åˆ’å’Œè¿½è¸ªï¼Œç¡®ä¿**æƒ³æ³•æ¸…æ™°**ã€**å®ç°å®Œæ•´**ã€**è¿‡ç¨‹å¯è¿½æº¯**ã€‚

### TODO çš„ä¸‰é‡è§’è‰²

TODO ä¸ä»…æ˜¯ä»»åŠ¡æ¸…å•ï¼Œæ›´æ˜¯ï¼š
1. **è§„åˆ’æ–‡æ¡£**ï¼šå°†æ¨¡ç³Šçš„æƒ³æ³•è½¬åŒ–ä¸ºå…·ä½“çš„ã€å¯éªŒè¯çš„å·¥ä½œé¡¹
2. **ä»£ç æ³¨é‡Š**ï¼šæ¯ä¸ª TODO èƒŒåçš„è®¾è®¡æ€è€ƒèå…¥ä»£ç ä¸­
3. **å˜æ›´æ€»ç»“**ï¼šæœ¬è½®è¿­ä»£å®Œæˆçš„å†…å®¹ä¸éªŒè¯æ ‡å‡†

### TODO åˆ›å»ºè§„èŒƒ

**ä½•æ—¶åˆ›å»º TODO**ï¼š
- æ¯å¼€å§‹ä¸€ä¸ªæ–°åŠŸèƒ½å¼€å‘
- æ¯è§£å†³ä¸€ä¸ªé‡å¤§ Bug
- æ¯æ¬¡é‡æ„æˆ–ä¼˜åŒ–
- æ¯æ¬¡å®éªŒæ€§æ¢ç´¢

**TODO æ ¼å¼**ï¼š

```
ID    | æ ‡é¢˜ï¼ˆç®€æ˜ï¼Œ3-7 å­—ï¼‰
------|----
æè¿°  | è¯¦ç»†è¯´æ˜è¯¥å·¥ä½œé¡¹çš„ç›®æ ‡ã€æ–¹æ³•ã€éªŒæ”¶æ ‡å‡†
      | åŒ…å«å…³é”®æ­¥éª¤ã€æŠ€æœ¯é€‰å‹ã€é¢„æœŸè¾“å‡ºã€å¯èƒ½çš„éšœç¢
```

**ç¤ºä¾‹**ï¼š

```
1 | éªŒè¯ MetadataWriter PNG å®ç°
---|
æè¿° | è¿è¡Œå•å…ƒæµ‹è¯•éªŒè¯ MetadataWriter.cs çš„ PNG äºŒè¿›åˆ¶å†™å…¥é€»è¾‘ã€‚
   | éœ€æµ‹è¯•ï¼štEXt å—é•¿åº¦ã€å¤§ç«¯åºã€CRC è®¡ç®—ã€å—æ’å…¥ã€IEND å®šä½ç­‰å…³é”®ç‚¹ã€‚
   | è‹¥å¤±è´¥åˆ™è°ƒè¯•ä¿®å¤ PNG å—æ„é€ é€»è¾‘ã€‚
   | éªŒæ”¶æ ‡å‡†ï¼š
   |   âœ“ tEXt å—é•¿åº¦æ­£ç¡®ï¼ˆå¤§ç«¯åº 4 å­—èŠ‚ï¼‰
   |   âœ“ CRC è®¡ç®—æ— è¯¯ï¼ˆé¢„è®¡ç®—è¡¨ + å¤šé¡¹å¼ 0xEDB88320ï¼‰
   |   âœ“ å—æ’å…¥åˆ° IEND å‰
   |   âœ“ è¯»å›å†…å®¹èƒ½è¢« ImageSharp/MetadataExtractor è¯†åˆ«
   |   âœ“ è¾“å‡º PNG æ–‡ä»¶å¯ç”¨å›¾ç‰‡æŸ¥çœ‹å™¨æ‰“å¼€

2 | å¼€å‘æ¨¡å¼æµ‹è¯• PNG è½¬æ¢ç«¯åˆ°ç«¯æµç¨‹
---|
æè¿° | åœ¨æµ‹è¯•ç›®å½•ï¼ˆC:\Users\SNOW\Desktop\testï¼‰è¿è¡Œå®Œæ•´è½¬æ¢æµç¨‹ï¼Œ
   | éªŒè¯ä»è¯»å–æºæ–‡ä»¶ â†’ è½¬æ¢ â†’ å†™å…¥å…ƒæ•°æ® â†’ éªŒè¯çš„å®Œæ•´é“¾è·¯ã€‚
   | æ£€æŸ¥è¾“å‡ºï¼š
   |   - PNG æ–‡ä»¶è½¬æ¢æˆåŠŸï¼Œå°ºå¯¸åˆç†ï¼Œè‰²å½©ç©ºé—´æ­£ç¡®
   |   - metadata-writer.log æ˜¾ç¤º Written=True/False, Verified=True/False
   |   - diagnosis-report-*.log æ˜¾ç¤ºè¯Šæ–­æ‘˜è¦ã€ç»Ÿè®¡æ•°æ®ã€å¤±è´¥åŸå› 
   |   - è¾“å‡ºæ–‡ä»¶å¤§å°åˆç†ï¼ˆéé›¶ï¼ŒéæŸåï¼‰
```

### TODO ç”Ÿå‘½å‘¨æœŸç®¡ç†

#### çŠ¶æ€å®šä¹‰

```
not-started  â†’  in-progress  â†’  completed
   (æœªå¼€å§‹)       (è¿›è¡Œä¸­)         (å·²å®Œæˆ)
```

**çŠ¶æ€è½¬ç§»è§„åˆ™**ï¼š
- ä»…åœ¨å¼€å§‹å·¥ä½œå‰çš„ç¬é—´ï¼Œæ ‡è®°ä¸º `in-progress`
- å®Œæˆå·¥ä½œå**ç«‹å³**æ ‡è®°ä¸º `completed`ï¼ˆä¸è¦ç­‰å¾…éªŒè¯æˆ–éƒ¨ç½²ï¼‰
- é¿å…é•¿æœŸåœç•™åœ¨ `in-progress` çŠ¶æ€ï¼ˆè¡¨ç¤ºå·¥ä½œå¡é¡¿ï¼‰

#### å·¥ä½œæµç¤ºä¾‹

```
å¼€å‘è€… A â†’ é€‰æ‹© TODO #3
         â†’ é˜…è¯» TODO æè¿°ä¸éªŒæ”¶æ ‡å‡†
         â†’ æ ‡è®°ä¸º in-progress
         â†’ ç¼–å†™ä»£ç å®ç° + å•å…ƒæµ‹è¯•
         â†’ æœ¬åœ°éªŒè¯é€šè¿‡
         â†’ æ ‡è®°ä¸º completed
         â†’ æäº¤ PR
         
å¼€å‘è€… B â†’ å®¡æŸ¥ PR æ—¶æ£€æŸ¥ TODO æè¿°
         â†’ éªŒè¯ä»£ç æ˜¯å¦æ»¡è¶³éªŒæ”¶æ ‡å‡†
         â†’ æ‰¹å‡†æˆ–è¦æ±‚ä¿®æ”¹
         â†’ åˆå¹¶å TODO æ­£å¼ç»“æŸ
```

### TODO ä¸ä»£ç çš„å…³è”

#### æ–¹å¼ 1ï¼šç›´æ¥åµŒå…¥ä»£ç æ³¨é‡Š

åœ¨ä»£ç ä¸­å¼•ç”¨ TODO ID å’ŒéªŒæ”¶æ ‡å‡†ï¼Œä¾¿äºä»£ç å®¡æŸ¥ï¼š

```csharp
/// <summary>
/// å†™å…¥å…ƒæ•°æ®å¹¶è‡ªåŠ¨éªŒè¯ã€‚
/// 
/// TODO #1: éªŒè¯ MetadataWriter PNG å®ç°
/// âœ“ tEXt å—é•¿åº¦æ­£ç¡®ï¼ˆå¤§ç«¯åº 4 å­—èŠ‚ï¼‰
/// âœ“ CRC è®¡ç®—æ— è¯¯ï¼ˆé¢„è®¡ç®—è¡¨ + å¤šé¡¹å¼ 0xEDB88320ï¼‰
/// âœ“ å—æ’å…¥åˆ° IEND å‰
/// âœ“ è¯»å›å†…å®¹èƒ½è¢« ImageSharp è¯†åˆ«
/// 
/// TODO #2: å¼€å‘æ¨¡å¼æµ‹è¯• PNG è½¬æ¢ç«¯åˆ°ç«¯æµç¨‹
/// åœ¨ MetadataWriter å®Œæˆåæµ‹è¯•è¯»-å†™-éªŒè¯é“¾è·¯
/// </summary>
public static (bool written, bool verified) WriteMetadata(
    string destPath, 
    ImageFormat destFormat, 
    AIMetadata aiMetadata)
{
    // TODO #1: éªŒè¯ tEXt å—æ„é€ é€»è¾‘
    // BuildPngTextChunk() å‡½æ•°ä¸­å·²å®ç°å¤§ç«¯åºé•¿åº¦ + CRC è®¡ç®—
    // è§ä¸‹æ–¹ WritePngTextChunk å®ç°
    
    try
    {
        var written = destFormat switch
        {
            ImageFormat.Png => WritePngTextChunk(destPath, "parameters", aiMetadata.FullInfo),
            ImageFormat.Jpeg => WriteJpegExifDescription(destPath, aiMetadata.FullInfo),
            ImageFormat.WebP => WriteWebPMetadata(destPath, aiMetadata.FullInfo),
            _ => false
        };
        
        // TODO #1: éªŒè¯è¯»å›ç»“æœ
        var verified = VerifyFullInfo(destPath, aiMetadata.FullInfo);
        return (written, verified);
    }
    catch (Exception ex)
    {
        LogError(destPath, ex.Message);
        return (false, false);
    }
}

private static bool WritePngTextChunk(string pngPath, string keyword, string text)
{
    // TODO #1: PNG äºŒè¿›åˆ¶å†™å…¥
    // 1. è¯»å…¥åŸå§‹ PNG å­—èŠ‚
    var bytes = File.ReadAllBytes(pngPath);
    
    // 2. å®šä½ IEND å—ï¼ˆ0x49454E44ï¼‰
    var iendIndex = IndexOfBytes(bytes, new byte[] { 0x49, 0x45, 0x4E, 0x44 });
    if (iendIndex < 0) throw new InvalidOperationException("PNG IEND å—æœªæ‰¾åˆ°");
    
    // 3. æ„é€ æ–°çš„ tEXt å—
    var newChunk = BuildPngTextChunk(keyword, text);
    
    // 4. åœ¨ IEND å‰æ’å…¥å—
    var result = new byte[bytes.Length + newChunk.Length];
    Buffer.BlockCopy(bytes, 0, result, 0, iendIndex);
    Buffer.BlockCopy(newChunk, 0, result, iendIndex, newChunk.Length);
    Buffer.BlockCopy(bytes, iendIndex, result, iendIndex + newChunk.Length, bytes.Length - iendIndex);
    
    // 5. å†™å›æ–‡ä»¶
    File.WriteAllBytes(pngPath, result);
    
    LogWrite(pngPath, "PNG", true, false, "WritePngTextChunk");
    return true;
}

private static byte[] BuildPngTextChunk(string keyword, string text)
{
    // TODO #1: PNG tEXt å—æ ¼å¼
    // å—ç»“æ„ï¼š
    //   [4å­—èŠ‚] å—é•¿åº¦ï¼ˆä¸åŒ…æ‹¬é•¿åº¦å’Œ CRC å­—æ®µï¼‰
    //   [4å­—èŠ‚] å—ç±»å‹ "tEXt" (0x74455874)
    //   [æ•°æ®]  keyword (Latin1) + '\0' + text (UTF8)
    //   [4å­—èŠ‚] CRC32 (å¤§ç«¯åº)
    
    using (var ms = new MemoryStream())
    {
        var keywordBytes = Encoding.Latin1.GetBytes(keyword);
        var textBytes = Encoding.UTF8.GetBytes(text);
        var dataLength = keywordBytes.Length + 1 + textBytes.Length; // +1 for null separator
        
        // å—é•¿åº¦ï¼ˆå¤§ç«¯åºï¼‰
        WriteBigEndianInt(ms, dataLength);
        
        // å—ç±»å‹
        ms.Write(new byte[] { 0x74, 0x45, 0x78, 0x74 }, 0, 4); // "tEXt"
        
        // æ•°æ®ï¼škeyword + null + text
        ms.Write(keywordBytes, 0, keywordBytes.Length);
        ms.WriteByte(0);
        ms.Write(textBytes, 0, textBytes.Length);
        
        // CRCï¼ˆå¯¹å—ç±»å‹ + æ•°æ®è®¡ç®—ï¼‰
        var crcData = new byte[4 + dataLength];
        Buffer.BlockCopy(new byte[] { 0x74, 0x45, 0x78, 0x74 }, 0, crcData, 0, 4);
        Buffer.BlockCopy(ms.ToArray(), 4, crcData, 4, dataLength);
        var crc = ComputePngCrc(crcData);
        WriteBigEndianInt(ms, crc);
        
        return ms.ToArray();
    }
}

private static uint ComputePngCrc(byte[] data)
{
    // TODO #1: PNG CRC32 è®¡ç®—
    // ä½¿ç”¨é¢„è®¡ç®—è¡¨ï¼ˆå¤šé¡¹å¼ 0xEDB88320ï¼‰
    // åˆå€¼ 0xFFFFFFFFï¼Œæœ€ç»ˆå¼‚æˆ– 0xFFFFFFFF
    
    const uint polynomial = 0xEDB88320;
    var crcTable = new uint[256];
    
    // æ„é€  CRC è¡¨ï¼ˆä»…åœ¨é¦–æ¬¡è°ƒç”¨æ—¶è®¡ç®—ï¼Œå¯ç¼“å­˜ï¼‰
    for (int i = 0; i < 256; i++)
    {
        uint crc = (uint)i;
        for (int j = 0; j < 8; j++)
            crc = (crc & 1) == 1 ? (crc >> 1) ^ polynomial : (crc >> 1);
        crcTable[i] = crc;
    }
    
    // è®¡ç®— CRC
    uint result = 0xFFFFFFFF;
    foreach (var b in data)
        result = (result >> 8) ^ crcTable[(result ^ b) & 0xFF];
    
    return result ^ 0xFFFFFFFF;
}
```

#### æ–¹å¼ 2ï¼šTODO ä¸å•å…ƒæµ‹è¯•å¯¹åº”

åœ¨æµ‹è¯•ç±»ä¸­ç›´æ¥å¼•ç”¨ TODOï¼Œç¡®ä¿æµ‹è¯•è¦†ç›–æ‰€æœ‰éªŒæ”¶æ ‡å‡†ï¼š

```csharp
public class MetadataWriterTests
{
    // TODO #1: éªŒè¯ MetadataWriter PNG å®ç°
    [Fact]
    public void WritePngTextChunk_ValidInput_CreatesValidTextChunk()
    {
        // éªŒæ”¶æ ‡å‡†ï¼šâœ“ tEXt å—é•¿åº¦æ­£ç¡®
        var pngPath = "test.png";
        var keyword = "parameters";
        var text = "Test metadata";
        
        MetadataWriter.WritePngTextChunk(pngPath, keyword, text);
        
        var bytes = File.ReadAllBytes(pngPath);
        var chunk = ExtractTextChunk(bytes);
        
        // å—é•¿åº¦åº”è¯¥æ˜¯ï¼škeywordé•¿åº¦ + 1(nullåˆ†éš”) + texté•¿åº¦
        var expectedLength = keyword.Length + 1 + text.Length;
        Assert.Equal(expectedLength, chunk.Length);
    }
    
    [Fact]
    public void WritePngTextChunk_CalculatesCrcCorrectly()
    {
        // éªŒæ”¶æ ‡å‡†ï¼šâœ“ CRC è®¡ç®—æ— è¯¯
        var crc = MetadataWriter.ComputePngCrc(testData);
        Assert.Equal(expectedCrc, crc);
    }
    
    [Fact]
    public void WritePngTextChunk_InsertsBeforeIend()
    {
        // éªŒæ”¶æ ‡å‡†ï¼šâœ“ å—æ’å…¥åˆ° IEND å‰
        var bytes = File.ReadAllBytes(outputPath);
        var iendIndex = IndexOfBytes(bytes, new byte[] { 0x49, 0x45, 0x4E, 0x44 });
        var textChunkIndex = IndexOfBytes(bytes, new byte[] { 0x74, 0x45, 0x78, 0x74 });
        
        Assert.True(textChunkIndex < iendIndex);
    }
}

// TODO #2: å¼€å‘æ¨¡å¼æµ‹è¯• PNG è½¬æ¢ç«¯åˆ°ç«¯æµç¨‹
public class IntegrationTests
{
    [Fact]
    public void ConvertAndVerify_PngToJpeg_PreservesMetadata()
    {
        // å®Œæ•´çš„è¯»-è½¬æ¢-å†™-éªŒè¯æµç¨‹
        var sourcePath = "input.png";
        var destPath = "output.jpg";
        
        var sourceMetadata = AIMetadataExtractor.ReadAIMetadata(sourcePath);
        var (success, converted) = ImageConverter.ConvertPngToJpeg(sourcePath, destPath);
        var (written, verified) = MetadataWriter.WriteMetadata(destPath, ImageFormat.Jpeg, sourceMetadata);
        
        Assert.True(success);
        Assert.True(written);
        Assert.True(verified);
    }
}
```

### TODO ä¸ç‰ˆæœ¬å‘å¸ƒçš„å…³è”

**å‘å¸ƒå‰æ£€æŸ¥æ¸…å•**ï¼š

```
å‘å¸ƒç‰ˆæœ¬ v1.1.0 å‰ï¼š
- [ ] æ‰€æœ‰ TODO çŠ¶æ€ä¸º completedï¼ˆæœªå®Œæˆçš„åº”è¿›è¡Œé£é™©è¯„ä¼°ï¼‰
- [ ] æ‰€æœ‰ TODO çš„éªŒæ”¶æ ‡å‡†å·²åœ¨æµ‹è¯•ä¸­éªŒè¯
- [ ] æ‰€æœ‰ TODO çš„ä»£ç å·²é€šè¿‡ Code Review
- [ ] CHANGELOG.md ä¸­æ€»ç»“äº†æœ¬ç‰ˆæœ¬çš„ TODO åˆ—è¡¨
- [ ] ç›¸å…³æ–‡æ¡£å·²æ›´æ–°ï¼Œå¼•ç”¨äº†æ–°åŠŸèƒ½çš„ TODO èƒŒæ™¯

ç¤ºä¾‹ CHANGELOG æ¡ç›®ï¼š
## [v1.1.0] - 2025-11-16

### Added
- å®Œæ•´ AI å…ƒæ•°æ®æå–ä¸å†™å› (TODO #1-#3)
  - å®ç° PNG tEXt å—äºŒè¿›åˆ¶å†™å…¥ï¼ˆå« CRC æ ¡éªŒï¼‰
  - æ”¯æŒå…ƒæ•°æ®è¯»å†™éªŒè¯é“¾è·¯
  
- è‡ªåŠ¨éªŒè¯ä¸è¯Šæ–­ç³»ç»Ÿ (TODO #4-#6)
  - LogAnalyzer è‡ªåŠ¨åˆ†ææ—¥å¿—ï¼Œç”Ÿæˆè¯Šæ–­æŠ¥å‘Š
  - æ”¯æŒåˆ†çº§å‘Šè­¦ï¼ˆDEBUG/INFO/WARN/ERROR/FATALï¼‰

### Fixed
- ä¿®å¤ JPEG/WebP å…ƒæ•°æ®è¯»å–è¿”å›ç©ºå€¼ (TODO #7)

### Documentation
- æ–°å¢ã€Šå‡å°‘äººå·¥å¹²é¢„å®è£…æŒ‡å—ã€‹(TODO #4-#6 å‚è€ƒ)
- æ–°å¢ã€ŠTODO ç®¡ç†è§„èŒƒã€‹
```

### TODO ç®¡ç†å·¥å…·ä¸æµç¨‹

**æ¨èå·¥å…·**ï¼š
- **æœ¬é¡¹ç›®**ï¼šVS Code é›†æˆçš„ TODO List æ‰©å±•ï¼ˆæ–¹ä¾¿å¿«é€ŸæŸ¥çœ‹ï¼‰
- **å¤‡é€‰**ï¼šGitHub Issuesï¼ˆç”¨äºå¤šäººåä½œï¼Œä¾¿äºè¿½è¸ªå’Œè¯„è®ºï¼‰
- **å›¢é˜Ÿåä½œ**ï¼šJiraã€Azure DevOpsï¼ˆå¤§å‹å›¢é˜Ÿï¼‰

**æ—¥å¸¸å·¥ä½œæµ**ï¼š

```bash
# å¼€å‘è€…å¼€å§‹ä¸€å¤©çš„å·¥ä½œ
1. æŸ¥çœ‹ TODO åˆ—è¡¨ï¼ˆ`manage_todo_list read`ï¼‰
2. é€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜çš„æœªå®Œæˆ TODO
3. æ ‡è®°ä¸º in-progress
4. ç¼–å†™ä»£ç  + å•å…ƒæµ‹è¯•ï¼ˆåœ¨ä»£ç ä¸­åµŒå…¥ TODO ID å’ŒéªŒæ”¶æ ‡å‡†ï¼‰
5. æœ¬åœ°æµ‹è¯•é€šè¿‡åï¼Œæ ‡è®°ä¸º completed
6. æäº¤ PRï¼Œæè¿°ä¸­å¼•ç”¨ TODO IDï¼ˆå¦‚ "Closes TODO #3"ï¼‰
7. Code Review æ—¶æ£€æŸ¥ TODO çš„éªŒæ”¶æ ‡å‡†æ˜¯å¦å…¨éƒ¨æ»¡è¶³
8. åˆå¹¶åï¼Œæ›´æ–° CHANGELOG

æ¯å‘¨å®¡æŸ¥ï¼š
- æ£€æŸ¥æ˜¯å¦æœ‰è¶…è¿‡ 3 å¤©ä»åœ¨ in-progress çš„ TODOï¼ˆè¡¨ç¤ºå¡é¡¿ï¼‰
- è¯†åˆ« blocked çš„ TODOï¼ˆç­‰å¾…å¤–éƒ¨è¾“å…¥æˆ–å†³ç­–ï¼‰
- é‡æ–°è¯„ä¼°ä¼˜å…ˆçº§ï¼Œç¡®ä¿é«˜ä»·å€¼çš„ TODO å¾—åˆ°åŠæ—¶æ¨è¿›
```

---

é¡¹ç›®æ–‡æ¡£åº”è¯¥æ¥è¿‘ **å®˜æ–¹æ–‡æ¡£ + TODO æ¸…å• + å¤‡æ³¨çš„ç»“åˆä½“**ã€‚

### å¿…å¤‡æ–‡æ¡£æ¸…å•

#### 1. README.mdï¼ˆé¦–é¡µï¼‰
**ç”¨é€”**ï¼šå¿«é€Ÿå…¥é—¨ | **ç›®æ ‡ç”¨æˆ·**ï¼šæ–°äººã€ä½¿ç”¨è€…  
**åŒ…å«å†…å®¹**ï¼š
- é¡¹ç›®ä¸€å¥è¯æ¦‚è¿°
- æ ¸å¿ƒç‰¹æ€§åˆ—è¡¨ï¼ˆBullet pointsï¼‰
- å¿«é€Ÿå¼€å§‹ï¼ˆæœ€å°‘ 3 è¡Œå‘½ä»¤ï¼‰
- é¡¹ç›®ç»“æ„ï¼ˆç›®å½•æ ‘ï¼‰
- ä¾èµ–è¯´æ˜ï¼ˆå®˜æ–¹ vs ç¬¬ä¸‰æ–¹ï¼‰
- å­¦ä¹ è·¯çº¿ï¼ˆæ¨èé˜…è¯»é¡ºåºï¼‰
- å¸¸è§é—®é¢˜ (FAQ)

#### 2. ARCHITECTURE.mdï¼ˆæ¶æ„æ–‡æ¡£ï¼‰
**ç”¨é€”**ï¼šè®¾è®¡å†³ç­–è®°å½• | **ç›®æ ‡ç”¨æˆ·**ï¼šå¼€å‘è€…ã€æ¶æ„å¸ˆ  
**åŒ…å«å†…å®¹**ï¼š
- ç³»ç»Ÿæ„¿æ™¯ä¸èŒƒå›´
- é«˜å±‚æ¶æ„å›¾ï¼ˆæ•°æ®æµï¼‰
- å…³é”®è®¾è®¡å†³ç­–ä¸æƒè¡¡
- æŠ€æœ¯æ ˆé€‰å‹ç†ç”±
- æ¨¡å—èŒè´£åˆ’åˆ†
- ä¾èµ–ç®¡ç†ç­–ç•¥

#### 3. FUNCTIONS_DIFFICULTY.mdï¼ˆå‡½æ•°éš¾åº¦ä¸é£é™©è¡¨ï¼‰
**ç”¨é€”**ï¼šå­¦ä¹ è·¯çº¿ + é£é™©è­¦ç¤º | **ç›®æ ‡ç”¨æˆ·**ï¼šå¼€å‘è€…ã€å­¦ä¹ è€…  
**åŒ…å«å†…å®¹**ï¼š
- å‡½æ•°å â†’ éš¾åº¦ç³»æ•°ï¼ˆ0-100ï¼‰
- ç®€è¦è¯´æ˜ï¼ˆä¸€å¥è¯ï¼‰
- ä½¿ç”¨çš„åº“ï¼ˆå®˜æ–¹/ç¬¬ä¸‰æ–¹ï¼‰
- ä¸¤å­—æ¦‚æ‹¬ï¼ˆä¾¿äºå¿«é€Ÿæ£€ç´¢ï¼‰
- **å…¥ä¾µæ€§/å±å®³æ€§**ï¼ˆä½/ä¸­/é«˜ï¼‰
- **éšæ‚£è¯¦ç»†**ï¼ˆæ½œåœ¨é£é™©è¯´æ˜ï¼‰
- **ä¼˜åŒ–ç©ºé—´**ï¼ˆæ”¹è¿›æ–¹å‘ï¼‰

#### 4. TESTING.mdï¼ˆæµ‹è¯•ç­–ç•¥ï¼‰
**ç”¨é€”**ï¼šæµ‹è¯•è¦†ç›–ä¸éªŒè¯ | **ç›®æ ‡ç”¨æˆ·**ï¼šå¼€å‘è€…ã€QA  
**åŒ…å«å†…å®¹**ï¼š
- æµ‹è¯•åˆ†ç±»ï¼ˆå•å…ƒ/é›†æˆ/ç«¯åˆ°ç«¯ï¼‰
- è¦†ç›–ç‡ç›®æ ‡ä¸ç°çŠ¶
- æµ‹è¯•æ•°æ®è¯´æ˜
- å¦‚ä½•è¿è¡Œæµ‹è¯•ï¼ˆå‘½ä»¤è¡Œï¼‰
- å·²çŸ¥çš„ç¼ºé™·æˆ– Skip çš„æµ‹è¯•åŠåŸå› 

#### 5. CHANGELOG.mdï¼ˆå˜æ›´æ—¥å¿—ï¼‰
**ç”¨é€”**ï¼šç‰ˆæœ¬è¿½è¸ª | **ç›®æ ‡ç”¨æˆ·**ï¼šä½¿ç”¨è€…ã€ç»´æŠ¤è€…  
**æ ¼å¼**ï¼š
```
## [ç‰ˆæœ¬å·] - æ—¥æœŸ

### Added
- æ–°åŠŸèƒ½ 1
- æ–°åŠŸèƒ½ 2

### Changed
- ä¿®æ”¹è¯´æ˜ 1
- ä¿®æ”¹è¯´æ˜ 2

### Fixed
- ä¿®å¤çš„ Bug 1

### Deprecated
- å°†è¦ç§»é™¤çš„åŠŸèƒ½

### Security
- å®‰å…¨ä¿®å¤
```

#### 6. CONTRIBUTING.mdï¼ˆè´¡çŒ®æŒ‡å—ï¼‰
**ç”¨é€”**ï¼šå¤šäººåä½œå…¥é—¨ | **ç›®æ ‡ç”¨æˆ·**ï¼šè´¡çŒ®è€…  
**åŒ…å«å†…å®¹**ï¼š
- è´¡çŒ®æµç¨‹ï¼ˆFork â†’ Branch â†’ PRï¼‰
- ä»£ç é£æ ¼æ£€æŸ¥æ¸…å•
- æäº¤æ¶ˆæ¯è§„èŒƒ
- å¦‚ä½•æœ¬åœ°å¼€å‘ä¸æµ‹è¯•
- Pull Request æ£€æŸ¥æ¸…å•

#### 7. PROJECT_CHARTER.mdï¼ˆæœ¬æ–‡æ¡£ï¼‰
**ç”¨é€”**ï¼šç»Ÿä¸€è§„èŒƒ | **ç›®æ ‡ç”¨æˆ·**ï¼šæ‰€æœ‰å‚ä¸è€…  
**åŒ…å«å†…å®¹**ï¼š
- æ ¸å¿ƒå¼€å‘å“²å­¦
- ç¼–ç è§„èŒƒ
- æ–‡æ¡£ä½“ç³»
- å¤šäººåä½œæ ‡å‡†
- å‘å¸ƒæµç¨‹

#### 8. RISK_ASSESSMENT.mdï¼ˆé£é™©è¯„ä¼°æŠ¥å‘Šï¼‰
**ç”¨é€”**ï¼šé¡¹ç›®é£é™©é¢„æµ‹ | **ç›®æ ‡ç”¨æˆ·**ï¼šé¡¹ç›®ç»ç†ã€æ¶æ„å¸ˆ  
**åŒ…å«å†…å®¹**ï¼šå‚è€ƒ [é¢„æµ‹æŠ¥å‘Šä¸é£é™©ç®¡ç†](#é¢„æµ‹æŠ¥å‘Šä¸é£é™©ç®¡ç†)

### æ–‡æ¡£ç»´æŠ¤è§„åˆ™

| æ–‡æ¡£ | æ›´æ–°é¢‘ç‡ | è§¦å‘æ¡ä»¶ |
|-----|--------|--------|
| README | æ¯ 1-2 å‘¨ | æ–°åŠŸèƒ½ã€ä¾èµ–å˜æ›´ |
| ARCHITECTURE | æ¯ 1-2 æœˆ | æ¶æ„è°ƒæ•´ã€é‡è¦å†³ç­– |
| FUNCTIONS_DIFFICULTY | æ¯æœˆ | æ–°å‡½æ•°ã€å¤æ‚åº¦å˜åŒ– |
| CHANGELOG | æ¯æ¬¡å‘å¸ƒ | æ–°ç‰ˆæœ¬ä¸Šçº¿ |
| CONTRIBUTING | æ¯å­£åº¦ | å·¥ä½œæµè°ƒæ•´ã€è§„èŒƒæ›´æ–° |
| ä»£ç æ³¨é‡Š | å®æ—¶ | æ¯æ¬¡ä»£ç æäº¤ |

---

## æµ‹è¯•ä¸éªŒè¯ç­–ç•¥

### æµ‹è¯•é‡‘å­—å¡”

```
        /\
       /  \           E2E æµ‹è¯•ï¼ˆ5%ï¼‰
      /    \          éªŒè¯å®Œæ•´å·¥ä½œæµ
     /------\
    /        \        é›†æˆæµ‹è¯•ï¼ˆ15%ï¼‰
   /          \       éªŒè¯æ¨¡å—é—´äº¤äº’
  /            \
 /              \     å•å…ƒæµ‹è¯•ï¼ˆ80%ï¼‰
/________________\    éªŒè¯å•ä¸ªå‡½æ•°
```

### å•å…ƒæµ‹è¯•è§„èŒƒ

**å‘½å**ï¼š`{TargetClass}Tests.cs`  
**æ¡†æ¶**ï¼šxUnit + FluentAssertionsï¼ˆå¯é€‰ï¼‰

```csharp
public class ImageConverterTests
{
    private const string _testImagePath = "test_image.png";
    
    public ImageConverterTests()
    {
        // Setup æµ‹è¯•æ•°æ®
    }
    
    [Fact]
    public void ConvertPngToJpeg_ValidInput_ReturnsOutputPath()
    {
        // Arrange
        var inputPath = Path.Combine(Path.GetTempPath(), _testImagePath);
        // ç”Ÿæˆæµ‹è¯•å›¾ç‰‡...
        
        // Act
        var result = ImageConverter.ConvertPngToJpeg(inputPath);
        
        // Assert
        Assert.NotEmpty(result);
        Assert.True(File.Exists(result));
        Assert.EndsWith(".jpg", result);
    }
    
    [Theory]
    [InlineData(0)]      // è´¨é‡è¿‡ä½
    [InlineData(101)]    // è´¨é‡è¿‡é«˜
    public void ConvertPngToJpeg_InvalidQuality_ThrowsException(int quality)
    {
        // Arrange
        var inputPath = Path.Combine(Path.GetTempPath(), _testImagePath);
        
        // Act & Assert
        Assert.Throws<ArgumentOutOfRangeException>(
            () => ImageConverter.ConvertPngToJpeg(inputPath, quality: quality)
        );
    }
}
```

### æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡

| é¡¹ç›®ç±»å‹ | è¦†ç›–ç‡ç›®æ ‡ | è¦†ç›–èŒƒå›´ |
|---------|----------|--------|
| å¾®å‹ | 30% | å…³é”®è·¯å¾„ |
| å°å‹ | 50% | æ ¸å¿ƒåŠŸèƒ½ |
| ä¸­å‹ | 70% | é™¤æç«¯è¾¹ç•Œ |
| å¤§å‹ | 80% | é™¤é—ç•™ä»£ç  |
| è¶…å¤§å‹ | 85%+ | åŒ…æ‹¬è¾¹ç•Œ |

### Read-Write-Verify éªŒè¯æ¨¡å¼

æ¯ä¸ªè½¬æ¢/ä¿®æ”¹æ“ä½œå¿…é¡»éµå¾ªä¸‰æ­¥æ³•ï¼š

```csharp
public static void ConvertAndVerify(string sourcePath, string destPath)
{
    // ç¬¬ä¸€æ­¥ï¼šè¯»å–æºæ•°æ®
    var sourceImage = Image.Load(sourcePath);
    var (createdUtc, modifiedUtc) = FileTimeService.ReadFileTimes(sourcePath);
    var aiMetadata = AIMetadataExtractor.ReadAIMetadata(sourcePath);
    
    // ç¬¬äºŒæ­¥ï¼šæ‰§è¡Œè½¬æ¢/ä¿®æ”¹
    var convertedImage = ImageConverter.ConvertPngToJpeg(sourcePath, destPath);
    FileTimeService.WriteFileTimes(destPath, createdUtc, modifiedUtc);
    AIMetadataExtractor.WriteAIMetadata(destPath, aiMetadata);
    
    // ç¬¬ä¸‰æ­¥ï¼šéªŒè¯ä¸€è‡´æ€§
    var (destCreatedUtc, destModifiedUtc) = FileTimeService.ReadFileTimes(destPath);
    var destAiMetadata = AIMetadataExtractor.ReadAIMetadata(destPath);
    
    Assert.True(FileTimeService.VerifyFileTimes(destPath, modifiedUtc));
    Assert.True(AIMetadataExtractor.VerifyAIMetadata(destPath, aiMetadata));
    Assert.True(ValidationService.ValidateConversion(sourcePath, destPath));
}
```

---

## å‡å°‘äººå·¥å¹²é¢„çš„å®è£…æŒ‡å—

æœ¬ç« è¯¦ç»†è¯´æ˜å¦‚ä½•é€šè¿‡è‡ªåŠ¨éªŒè¯ã€æ—¥å¿—å‘Šè­¦ã€è¯Šæ–­æŠ¥å‘Šç­‰æ‰‹æ®µï¼Œ**å°†éœ€è¦äººå·¥ç¡®è®¤çš„æ“ä½œè‡ªåŠ¨åŒ–**ã€‚

### æ ¸å¿ƒç­–ç•¥

#### 1. è‡ªåŠ¨éªŒè¯ï¼ˆAutomated Verificationï¼‰

**åŸåˆ™**ï¼šæ¯ä¸ªå…³é”®æ“ä½œçš„å†™å…¥åç«‹å³è¿›è¡Œè¯»å›éªŒè¯ï¼Œæ— éœ€äººå·¥æ£€æŸ¥

**å®è£…åœºæ™¯**ï¼š

| æ“ä½œ | å†™å…¥å†…å®¹ | éªŒè¯æ–¹æ³• | å¤±è´¥å¤„ç† |
|-----|--------|--------|--------|
| å›¾ç‰‡æ ¼å¼è½¬æ¢ | æ–°çš„ PNG/JPG/WebP | è¯»å›å°ºå¯¸/è‰²å½©ç©ºé—´ï¼Œæ¯”å¯¹æºæ–‡ä»¶ | è®°å½• ERRORï¼Œåˆ—å…¥å¤±è´¥æ¸…å• |
| å…ƒæ•°æ®æå– | AI Promptã€Modelã€Steps ç­‰ | æå–åéªŒè¯å­—æ®µå®Œæ•´æ€§ | è‡ªåŠ¨é™çº§åˆ° RawBytes |
| å…ƒæ•°æ®å†™å…¥ | FullInfo å†™å› PNG tEXt å— | è¯»å›å¹¶ç”¨ substring æ¯”å¯¹ | è®°å½• WARNï¼Œç»§ç»­å¤„ç† |
| æ–‡ä»¶æ—¶é—´æˆ³ | ä¿®æ”¹æ—¶é—´ã€åˆ›å»ºæ—¶é—´ | å†™åè¯»å›ï¼Œå¯¹æ¯”åŸå§‹å€¼ | å¹³å°ä¸æ”¯æŒæ—¶æ ‡è®°ä¸º INFO |
| æŠ¥å‘Šç”Ÿæˆ | XLSX æ–‡ä»¶ | éªŒè¯æ–‡ä»¶å¤§å°ã€è¡Œæ•°æ˜¯å¦åŒ¹é…è®°å½•æ•° | é‡æ–°ç”Ÿæˆæˆ–æŠ¥å‘Šå¼‚å¸¸ |

**ä»£ç ç¤ºä¾‹**ï¼š
```csharp
/// <summary>
/// å°†å…ƒæ•°æ®å†™å…¥è¾“å‡ºæ–‡ä»¶ï¼Œå¹¶è‡ªåŠ¨éªŒè¯å†™å…¥æˆåŠŸã€‚
/// </summary>
/// <returns>(metadataWritten, metadataVerified)</returns>
public static (bool written, bool verified) WriteMetadata(
    string destPath, 
    ImageFormat destFormat, 
    AIMetadata aiMetadata)
{
    try
    {
        // å†™å…¥
        var written = destFormat switch
        {
            ImageFormat.Png => WritePngTextChunk(destPath, "parameters", aiMetadata.FullInfo),
            ImageFormat.Jpeg => WriteJpegExifDescription(destPath, aiMetadata.FullInfo),
            ImageFormat.WebP => WriteWebPMetadata(destPath, aiMetadata.FullInfo),
            _ => false
        };
        
        if (!written)
        {
            LogWrite(destPath, destFormat.ToString(), false, false, "WriteMethod");
            return (false, false);
        }
        
        // éªŒè¯ï¼šè¯»å›å¹¶æ£€æŸ¥
        var verified = VerifyFullInfo(destPath, aiMetadata.FullInfo);
        LogWrite(destPath, destFormat.ToString(), written, verified, "WriteMethod");
        
        return (written, verified);
    }
    catch (Exception ex)
    {
        LogError(destPath, ex.Message);
        return (false, false);
    }
}

private static bool VerifyFullInfo(string filePath, string expectedFullInfo)
{
    try
    {
        var readBack = AIMetadataExtractor.ReadAIMetadata(filePath)?.FullInfo;
        // é‡‡ç”¨å­ä¸²æ£€æŸ¥ï¼šåªè¦åŒ…å«äº†å…³é”®ä¿¡æ¯å°±è§†ä¸ºæˆåŠŸ
        return readBack != null && readBack.Contains(expectedFullInfo);
    }
    catch
    {
        return false;
    }
}
```

#### 2. æ™ºèƒ½å‘Šè­¦ç³»ç»Ÿï¼ˆIntelligent Alert Systemï¼‰

**åŸåˆ™**ï¼šé—®é¢˜è‡ªåŠ¨åˆ†ç±»ã€æ±‡æ€»ã€ä¼˜å…ˆæ’åºï¼Œç”¨æˆ·åªéœ€æŸ¥çœ‹æŠ¥å‘Šä¸­çš„å¼‚å¸¸

**å‘Šè­¦çº§åˆ«**ï¼š

```
DEBUG   â†’ å¼€å‘è°ƒè¯•ä¿¡æ¯ï¼ˆä¸€èˆ¬ä¸åœ¨ç”Ÿäº§æ—¥å¿—ä¸­è¾“å‡ºï¼‰
INFO    â†’ æ­£å¸¸è¿›åº¦ä¿¡æ¯ï¼ˆè½¬æ¢æˆåŠŸã€å¤„ç†æ–‡ä»¶æ•°ï¼‰
WARN    â†’ æ½œåœ¨é—®é¢˜ä½†å¯ç»§ç»­ï¼ˆå…ƒæ•°æ®æˆªæ–­ã€å…¼å®¹æ€§æç¤ºã€éªŒè¯ä¸é€šè¿‡ä½†éå…³é”®ï¼‰
ERROR   â†’ å•æ¬¡æ“ä½œå¤±è´¥ï¼ˆè½¬æ¢å¤±è´¥ã€æƒé™é”™è¯¯ã€æ–‡ä»¶æŸåï¼‰
FATAL   â†’ ä¸å¯æ¢å¤é”™è¯¯ï¼ˆèµ„æºè€—å°½ã€æ ¸å¿ƒä¾èµ–å¤±è´¥ï¼‰
```

**æ±‡æ€»æ–¹æ¡ˆ**ï¼š

```csharp
/// <summary>
/// è¯Šæ–­æŠ¥å‘Šï¼šè‡ªåŠ¨åˆ†ææ—¥å¿—ï¼Œç”Ÿæˆé—®é¢˜æ±‡æ€»ã€‚
/// </summary>
public class DiagnosisReport
{
    public int TotalFiles { get; set; }
    public int SuccessfulConversions { get; set; }
    public int FailedConversions { get; set; }
    public int MetadataExtracted { get; set; }
    public int MetadataWriteFailures { get; set; }
    
    // è­¦å‘Šé˜ˆå€¼
    public bool HasAlarm => 
        (double)FailedConversions / TotalFiles > 0.1 ||  // >10% è½¬æ¢å¤±è´¥
        (double)MetadataWriteFailures / TotalFiles > 0.05;  // >5% å…ƒæ•°æ®å†™å…¥å¤±è´¥
    
    public List<string> Suggestions { get; set; }  // æ”¹è¿›å»ºè®®åˆ—è¡¨
}
```

**æ—¥å¿—è¾“å‡ºç¤ºä¾‹**ï¼š
```
[2025-11-16 14:30:22] [INFO] [ConversionService] å¼€å§‹å¤„ç†ç›®å½•: C:\images
[2025-11-16 14:30:23] [INFO] [FileScanner] å‘ç° 150 ä¸ªå›¾ç‰‡æ–‡ä»¶
[2025-11-16 14:30:25] [INFO] [ImageConverter] è½¬æ¢æˆåŠŸ: image_001.png â†’ image_001.jpg
[2025-11-16 14:30:26] [WARN] [AIMetadataExtractor] å…ƒæ•°æ®æå–ä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ (RawBytes): image_002.png
[2025-11-16 14:30:27] [ERROR] [ImageConverter] è½¬æ¢å¤±è´¥: image_003.gif (æ ¼å¼ä¸æ”¯æŒ)
[2025-11-16 14:30:28] [WARN] [MetadataWriter] å…ƒæ•°æ®å†™å…¥éªŒè¯å¤±è´¥: image_005.jpg (éƒ¨åˆ†å­—æ®µç¼ºå¤±)
...
[2025-11-16 14:30:45] [INFO] [ReportService] æŠ¥å‘Šå·²ç”Ÿæˆ: conversion-report-20251116-143045.xlsx

=============== è¯Šæ–­æ‘˜è¦ ===============
æ€»å¤„ç†: 150 | æˆåŠŸ: 148 | å¤±è´¥: 2 | æˆåŠŸç‡: 98.67%
å…ƒæ•°æ®æå–: 145 | å®Œæ•´ä¿¡æ¯: 138 | å¤‡ç”¨æ–¹æ¡ˆ: 7
å…ƒæ•°æ®å†™å…¥: 146 | éªŒè¯é€šè¿‡: 143 | éªŒè¯å¤±è´¥: 3

âš ï¸ WARN è­¦å‘Š:
  - image_002.png: RawBytes å¤‡ç”¨æ–¹æ¡ˆ
  - image_005.jpg: å…ƒæ•°æ®éªŒè¯å¤±è´¥ (ç¼ºå¤± steps å­—æ®µ)
  - image_012.png: æ–‡ä»¶æ—¶é—´æˆ³æ— æ³•è®¾ç½® (Linux ä¸æ”¯æŒ)

âŒ ERROR å¤±è´¥:
  - image_003.gif: æ ¼å¼ä¸æ”¯æŒ (GIF animated)
  - image_042.jpg: æ–‡ä»¶æŸå (truncated JPEG)

ğŸ’¡ å»ºè®®:
  1. æ£€æŸ¥ image_003.gif å’Œ image_042.jpgï¼Œè€ƒè™‘æ‰‹åŠ¨è½¬æ¢æˆ–æ›¿æ¢æºæ–‡ä»¶
  2. å¯¹äº RawBytes å¤‡ç”¨æ–¹æ¡ˆçš„æ–‡ä»¶ï¼Œè€ƒè™‘ä½¿ç”¨ä¸“é—¨å·¥å…·æå–å®Œæ•´å…ƒæ•°æ®
  3. Linux ç¯å¢ƒä¸‹æ— æ³•è®¾ç½®åˆ›å»ºæ—¶é—´ï¼Œä½†ä¿®æ”¹æ—¶é—´å·²åº”ç”¨

æŠ¥å‘Šä½ç½®: C:\Users\SNOW\Desktop\test\diagnosis-report-20251116-143045.log
========================================
```

#### 3. æ—¥å¿—ç³»ç»Ÿï¼ˆLogging Systemï¼‰

**åŸåˆ™**ï¼šå…³é”®æ“ä½œè‡ªåŠ¨è®°å½•åˆ°æ–‡ä»¶ï¼Œç”Ÿæˆå¯æ£€ç´¢çš„è¯Šæ–­è¯æ®

**æ—¥å¿—æ–‡ä»¶è§„åˆ’**ï¼š

```
å·¥ä½œç›®å½•/
â”œâ”€â”€ metadata-extraction-log.log      (å…ƒæ•°æ®æå–æ—¥å¿—ï¼Œä»…è®° ALARM å’Œ RawBytes)
â”œâ”€â”€ metadata-writer.log               (å…ƒæ•°æ®å†™å…¥éªŒè¯ç»“æœ)
â””â”€â”€ sourceFolder/
    â”œâ”€â”€ conversion-report-20251116-143022.xlsx  (è½¬æ¢æŠ¥å‘Šï¼ŒåŒ…å«æ‰€æœ‰å­—æ®µ)
    â”œâ”€â”€ conversion.log                          (è¿½åŠ å¼æ—¥å¿—ï¼Œç´¯ç§¯æ‰€æœ‰å†å²)
    â””â”€â”€ diagnosis-report-20251116-143045.log    (è¯Šæ–­æŠ¥å‘Šï¼Œç»Ÿè®¡+å»ºè®®)
```

**æ—¥å¿—è®°å½•å‡½æ•°**ï¼š

```csharp
// å…ƒæ•°æ®æå–æ—¥å¿—ï¼ˆç®€æ´ç‰ˆï¼Œä»…è®°å…³é”®äº‹ä»¶ï¼‰
private static void LogExtraction(string filePath, string method, string? alarm = null)
{
    var logFile = Path.Combine(AppContext.BaseDirectory, "metadata-extraction-log.log");
    var line = $"[{DateTime.UtcNow:yyyy-MM-dd HH:mm:ss}] {Path.GetFileName(filePath)} | "
             + $"Method={method} | "
             + (alarm != null ? $"ALARM: {alarm}" : "OK");
    File.AppendAllText(logFile, line + "\n");
}

// å…ƒæ•°æ®å†™å…¥æ—¥å¿—ï¼ˆéªŒè¯ç»“æœï¼‰
private static void LogWrite(
    string filePath, 
    string format, 
    bool written, 
    bool verified, 
    string method)
{
    var logFile = Path.Combine(AppContext.BaseDirectory, "metadata-writer.log");
    var status = (written, verified) switch
    {
        (true, true) => "âœ“ Written + Verified",
        (true, false) => "âš  Written, Verification Failed",
        (false, _) => "âœ— Write Failed"
    };
    
    var line = $"[{DateTime.UtcNow:yyyy-MM-dd HH:mm:ss}] {Path.GetFileName(filePath)} | "
             + $"Format={format} | {status} | Method={method}";
    File.AppendAllText(logFile, line + "\n");
}
```

#### 4. è¯Šæ–­æŠ¥å‘Šç”Ÿæˆï¼ˆDiagnostic Report Generationï¼‰

**åŸåˆ™**ï¼šè‡ªåŠ¨åˆ†ææ—¥å¿—ï¼Œç”Ÿæˆäººç±»å¯è¯»çš„è¯Šæ–­æŠ¥å‘Šï¼Œæ— éœ€äººå·¥ç¿»æŸ¥æ—¥å¿—

**æŠ¥å‘Šå†…å®¹**ï¼š

```
è¯Šæ–­æŠ¥å‘Š (diagnosis-report-{timestamp}.log)
â”œâ”€â”€ å¤´éƒ¨ä¿¡æ¯
â”‚   â”œâ”€â”€ ç”Ÿæˆæ—¶é—´
â”‚   â”œâ”€â”€ æºç›®å½•
â”‚   â”œâ”€â”€ å¤„ç†è€—æ—¶
â”‚   â””â”€â”€ è½¬æ¢å‚æ•°
â”œâ”€â”€ ç»Ÿè®¡æ•°æ®
â”‚   â”œâ”€â”€ æ€»æ–‡ä»¶æ•°ã€æˆåŠŸæ•°ã€å¤±è´¥æ•°ã€æˆåŠŸç‡
â”‚   â”œâ”€â”€ å…ƒæ•°æ®æå–ï¼šå®Œæ•´ã€RawBytesã€ç¼“å­˜å‘½ä¸­ç‡
â”‚   â””â”€â”€ å…ƒæ•°æ®å†™å…¥ï¼šæˆåŠŸã€éªŒè¯å¤±è´¥ã€æœªå°è¯•
â”œâ”€â”€ è­¦å‘Šé˜ˆå€¼æ£€æŸ¥
â”‚   â”œâ”€â”€ è½¬æ¢å¤±è´¥ç‡ > 10%ï¼Ÿâ†’ æ ‡è®°ä¸º ALARM
â”‚   â”œâ”€â”€ RawBytes æ¯”ä¾‹ > 5%ï¼Ÿâ†’ å»ºè®®æ”¹è¿›å…ƒæ•°æ®æº
â”‚   â””â”€â”€ éªŒè¯å¤±è´¥ç‡ > 5%ï¼Ÿâ†’ å»ºè®®æ£€æŸ¥è¾“å‡ºæ ¼å¼å…¼å®¹æ€§
â”œâ”€â”€ å¤±è´¥è¯¦æƒ…ï¼ˆä»…åˆ—å¤±è´¥çš„ï¼Œæœ€å¤šå‰ 20 æ¡ï¼‰
â”‚   â”œâ”€â”€ æ–‡ä»¶å
â”‚   â”œâ”€â”€ å¤±è´¥åŸå› 
â”‚   â””â”€â”€ å»ºè®®æ“ä½œ
â””â”€â”€ æ”¹è¿›å»ºè®®ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼ŒåŸºäºæ£€æµ‹åˆ°çš„é—®é¢˜ï¼‰
    â”œâ”€â”€ ä¿®å¤å»ºè®®ï¼ˆå¦‚ä½•å¤„ç†å¤±è´¥æ–‡ä»¶ï¼‰
    â”œâ”€â”€ ä¼˜åŒ–å»ºè®®ï¼ˆå¦‚ä½•æé«˜æˆåŠŸç‡ï¼‰
    â””â”€â”€ æ–‡æ¡£å‚è€ƒï¼ˆå¯¹åº”çš„å·¥ä½œæŒ‡å—é“¾æ¥ï¼‰
```

**è¯Šæ–­æŠ¥å‘Šå®è£…**ï¼š

```csharp
public static void GenerateDiagnosisReport(
    List<ConversionReportRow> rows,
    string sourceDir,
    TimeSpan duration)
{
    var timestamp = DateTime.UtcNow.ToString("yyyyMMdd-HHmmss");
    var reportPath = Path.Combine(sourceDir, $"diagnosis-report-{timestamp}.log");
    
    var successCount = rows.Count(r => r.Success);
    var failureCount = rows.Count(r => !r.Success);
    var successRate = (double)successCount / rows.Count * 100;
    
    var sb = new StringBuilder();
    sb.AppendLine("==================== è¯Šæ–­æŠ¥å‘Š ====================");
    sb.AppendLine($"ç”Ÿæˆæ—¶é—´: {DateTime.UtcNow:yyyy-MM-dd HH:mm:ss} (UTC)");
    sb.AppendLine($"æºç›®å½•: {sourceDir}");
    sb.AppendLine($"å¤„ç†è€—æ—¶: {duration.TotalSeconds:F1} ç§’");
    sb.AppendLine();
    
    // ç»Ÿè®¡
    sb.AppendLine("ã€ç»Ÿè®¡æ•°æ®ã€‘");
    sb.AppendLine($"æ€»è®¡: {rows.Count} | æˆåŠŸ: {successCount} | å¤±è´¥: {failureCount} | æˆåŠŸç‡: {successRate:F1}%");
    
    // è­¦å‘Š
    if (failureCount > rows.Count * 0.1)
        sb.AppendLine("âš ï¸ è­¦å‘Šï¼šè½¬æ¢å¤±è´¥ç‡ > 10%");
    if (rows.Count(r => r.FullAIMetadataExtractionMethod == "RawBytes") > rows.Count * 0.05)
        sb.AppendLine("âš ï¸ è­¦å‘Šï¼šRawBytes å¤‡ç”¨æ–¹æ¡ˆå æ¯” > 5%");
    
    // å¤±è´¥è¯¦æƒ…
    if (failureCount > 0)
    {
        sb.AppendLine();
        sb.AppendLine("ã€å¤±è´¥è¯¦æƒ…ã€‘(å‰ 5 æ¡)");
        foreach (var row in rows.Where(r => !r.Success).Take(5))
        {
            sb.AppendLine($"  âŒ {Path.GetFileName(row.SourcePath)}: {row.ErrorMessage}");
        }
    }
    
    // å»ºè®®
    sb.AppendLine();
    sb.AppendLine("ã€æ”¹è¿›å»ºè®®ã€‘");
    if (failureCount > 0)
        sb.AppendLine("  1. æ£€æŸ¥å¤±è´¥æ–‡ä»¶åˆ—è¡¨ï¼Œè€ƒè™‘æ‰‹åŠ¨ä¿®å¤æˆ–æ’é™¤");
    if (rows.Count(r => !r.MetadataWritten) > 0)
        sb.AppendLine("  2. éƒ¨åˆ†æ–‡ä»¶å…ƒæ•°æ®å†™å…¥å¤±è´¥ï¼Œæ£€æŸ¥è¾“å‡ºæ ¼å¼æ˜¯å¦æ”¯æŒè¯¥å…ƒæ•°æ®");
    
    sb.AppendLine("==============================================");
    
    File.WriteAllText(reportPath, sb.ToString());
}
```

#### 5. æ§åˆ¶å°æ‘˜è¦æ˜¾ç¤ºï¼ˆConsole Summary Displayï¼‰

**åŸåˆ™**ï¼šåœ¨æ§åˆ¶å°è¾“å‡ºç²¾ç®€çš„æ‘˜è¦ï¼Œè®©ç”¨æˆ·ä¸€çœ¼çœ‹æ¸…ç»“æœï¼Œæ— éœ€æ‰“å¼€æ–‡ä»¶

**æ˜¾ç¤ºå†…å®¹**ï¼š

```
[Program.cs è¾“å‡º]

âœ… è½¬æ¢å®Œæˆï¼

ğŸ“Š å¤„ç†ç»Ÿè®¡:
   æ€»è®¡: 150 ä¸ªæ–‡ä»¶
   âœ“ æˆåŠŸ: 148 ä¸ª (98.67%)
   âœ— å¤±è´¥: 2 ä¸ª (1.33%)

ğŸ“‹ å…ƒæ•°æ®ç»Ÿè®¡:
   å®Œæ•´ä¿¡æ¯: 138 ä¸ª (92%)
   å¤‡ç”¨æ–¹æ¡ˆ: 7 ä¸ª (4.67%, RawBytes)
   ç¼“å­˜å‘½ä¸­: 5 ä¸ª (3.33%)
   
   âœ“ å·²å†™å…¥: 146 ä¸ª
   âœ“ å·²éªŒè¯: 143 ä¸ª

âš ï¸ è­¦å‘Šä¿¡æ¯:
   - image_002.png: ä½¿ç”¨ RawBytes å¤‡ç”¨æ–¹æ¡ˆ
   - image_005.jpg: å…ƒæ•°æ®éªŒè¯å¤±è´¥ (ç¼ºå¤± steps å­—æ®µ)
   (å…± 3 æ¡è­¦å‘Šï¼Œè¯¦è§: diagnosis-report-20251116-143045.log)

âŒ å¤±è´¥ä¿¡æ¯:
   - image_003.gif: æ ¼å¼ä¸æ”¯æŒ (GIF animated)
   - image_042.jpg: æ–‡ä»¶æŸå (truncated JPEG)

ğŸ“ è¾“å‡ºä½ç½®:
   è½¬æ¢æŠ¥å‘Š: C:\Users\SNOW\Desktop\test\conversion-report-20251116-143045.xlsx
   è¯Šæ–­æ—¥å¿—: C:\Users\SNOW\Desktop\test\diagnosis-report-20251116-143045.log
   
ğŸ’¡ å¿«é€Ÿè¯Šæ–­: 98.67% æˆåŠŸç‡ï¼Œæ— é‡å¤§è­¦å‘Šã€‚è‹¥éœ€è¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹è¯Šæ–­æ—¥å¿—ã€‚

æŒ‰ä»»æ„é”®ç»§ç»­...
```

**å®è£…ä»£ç **ï¼š

```csharp
// Program.cs
public static void DisplaySummary(List<ConversionReportRow> rows, TimeSpan duration)
{
    var successCount = rows.Count(r => r.Success);
    var failureCount = rows.Count(r => !r.Success);
    
    Console.WriteLine("\nâœ… è½¬æ¢å®Œæˆï¼\n");
    Console.WriteLine("ğŸ“Š å¤„ç†ç»Ÿè®¡:");
    Console.WriteLine($"   æ€»è®¡: {rows.Count} ä¸ªæ–‡ä»¶");
    Console.WriteLine($"   âœ“ æˆåŠŸ: {successCount} ä¸ª ({(double)successCount/rows.Count*100:F2}%)");
    Console.WriteLine($"   âœ— å¤±è´¥: {failureCount} ä¸ª ({(double)failureCount/rows.Count*100:F2}%)");
    Console.WriteLine($"   è€—æ—¶: {duration.TotalSeconds:F1} ç§’\n");
    
    // å…ƒæ•°æ®ç»Ÿè®¡
    var withMetadata = rows.Count(r => !string.IsNullOrEmpty(r.FullAIMetadata));
    var metadataWritten = rows.Count(r => r.MetadataWritten);
    var metadataVerified = rows.Count(r => r.MetadataVerified);
    
    Console.WriteLine("ğŸ“‹ å…ƒæ•°æ®ç»Ÿè®¡:");
    Console.WriteLine($"   âœ“ æå–: {withMetadata} ä¸ª");
    Console.WriteLine($"   âœ“ å·²å†™å…¥: {metadataWritten} ä¸ª");
    Console.WriteLine($"   âœ“ å·²éªŒè¯: {metadataVerified} ä¸ª\n");
    
    // å‘Šè­¦ä¸å»ºè®®
    if (failureCount > rows.Count * 0.1)
    {
        Console.ForegroundColor = ConsoleColor.Yellow;
        Console.WriteLine("âš ï¸ è­¦å‘Šï¼šè½¬æ¢æˆåŠŸç‡ä½äº 90%");
        Console.ResetColor();
    }
    
    Console.WriteLine("\nâœ¨ æŠ¥å‘Šå·²ç”Ÿæˆï¼š");
    Console.WriteLine("   - conversion-report-{timestamp}.xlsx");
    Console.WriteLine("   - diagnosis-report-{timestamp}.log");
}
```

#### 6. è‡ªåŠ¨é™çº§ä¸å®¹é”™ï¼ˆAuto-Degradation & Graceful Failuresï¼‰

**åŸåˆ™**ï¼šå…³é”®æ“ä½œå¤±è´¥æ—¶è‡ªåŠ¨é™çº§ï¼Œè€Œéä¸­æ–­æµç¨‹

**é™çº§ç­–ç•¥**ï¼š

| å¤±è´¥ç‚¹ | é™çº§æ–¹æ¡ˆ | ç»§ç»­å¤„ç† |
|--------|--------|--------|
| å…ƒæ•°æ®æå–ï¼ˆMetadataExtractor åº“å¤±è´¥ï¼‰ | è‡ªåŠ¨å°è¯• RawBytes æ–¹æ¡ˆ | âœ… æ˜¯ |
| å…ƒæ•°æ®æå–ï¼ˆRawBytes ä¹Ÿå¤±è´¥ï¼‰ | æ ‡è®°ä¸ºç©ºï¼Œç»§ç»­è½¬æ¢ | âœ… æ˜¯ |
| å…ƒæ•°æ®å†™å…¥ï¼ˆPNG tEXt å—æ„é€ å¤±è´¥ï¼‰ | è®°å½• ERRORï¼Œä¸ä¸­æ–­è½¬æ¢ | âœ… æ˜¯ |
| æ–‡ä»¶æ—¶é—´æˆ³è®¾ç½®ï¼ˆLinux ä¸æ”¯æŒï¼‰ | æ ‡è®°ä¸º INFO è€Œé ERROR | âœ… æ˜¯ |
| è½¬æ¢éªŒè¯å¤±è´¥ | æ ‡è®°ä¸º WARNï¼Œä¿ç•™è¾“å‡ºæ–‡ä»¶ | âœ… æ˜¯ |

**ä»£ç ç¤ºä¾‹**ï¼š
```csharp
public static AIMetadata? ReadAIMetadata(string imagePath)
{
    try
    {
        // å°è¯•æ–¹æ¡ˆ 1ï¼šMetadataExtractor
        var metadata = ReadWithMetadataExtractor(imagePath);
        if (!string.IsNullOrEmpty(metadata?.FullInfo))
        {
            LogExtraction(imagePath, "MetadataExtractor");
            return metadata;
        }
    }
    catch (Exception ex)
    {
        LogExtraction(imagePath, "MetadataExtractor", $"å¤±è´¥: {ex.Message}");
    }
    
    try
    {
        // é™çº§æ–¹æ¡ˆ 1ï¼šRawBytes
        var metadata = ReadWithRawBytes(imagePath);
        if (!string.IsNullOrEmpty(metadata?.FullInfo))
        {
            LogExtraction(imagePath, "RawBytes");
            return metadata;
        }
    }
    catch (Exception ex)
    {
        LogExtraction(imagePath, "RawBytes", $"å¤±è´¥: {ex.Message}");
    }
    
    // é™çº§æ–¹æ¡ˆ 2ï¼šè¿”å›ç©ºå…ƒæ•°æ®ï¼Œç»§ç»­å¤„ç†
    LogExtraction(imagePath, "None", "æ— æ³•æå–å…ƒæ•°æ®");
    return new AIMetadata { FullInfo = string.Empty };
}
```

### æ£€æŸ¥æ¸…å•ï¼šå‡å°‘äººå·¥å¹²é¢„

éƒ¨ç½²ä¸Šè¿°ç­–ç•¥æ—¶ï¼Œç¡®ä¿è¦†ç›–ä»¥ä¸‹æ£€æŸ¥é¡¹ï¼š

- [ ] **è‡ªåŠ¨éªŒè¯**ï¼šæ‰€æœ‰å…³é”®å†™å…¥æ“ä½œéƒ½æœ‰å¯¹åº”çš„è¯»å›éªŒè¯
- [ ] **å‘Šè­¦åˆ†çº§**ï¼šDEBUG/INFO/WARN/ERROR/FATAL çº§åˆ«æ¸…æ™°åˆ’åˆ†
- [ ] **æ—¥å¿—è®°å½•**ï¼šå…³é”®æ“ä½œã€å¼‚å¸¸ã€éªŒè¯ç»“æœéƒ½æœ‰æ—¥å¿—è®°å½•
- [ ] **è¯Šæ–­æŠ¥å‘Š**ï¼šè‡ªåŠ¨ç”Ÿæˆç»Ÿè®¡ã€è­¦å‘Šã€å»ºè®®çš„è¯Šæ–­æŠ¥å‘Š
- [ ] **æ§åˆ¶å°æ‘˜è¦**ï¼šåœ¨ç¨‹åºé€€å‡ºå‰è¾“å‡ºç²¾ç®€æ‘˜è¦ï¼ŒåŒ…æ‹¬æˆåŠŸç‡ã€å¤±è´¥åŸå› ã€æ–‡ä»¶ä½ç½®
- [ ] **è‡ªåŠ¨é™çº§**ï¼šå…³é”®è·¯å¾„æœ‰å¤‡é€‰æ–¹æ¡ˆï¼Œé¿å…å› ä¸€ä¸ªæ¨¡å—å¤±è´¥å¯¼è‡´æ•´ä½“ä¸­æ–­
- [ ] **å¼‚å¸¸æ•è·**ï¼šæ‰€æœ‰å¼‚å¸¸éƒ½è¢«è®°å½•å¹¶è½¬åŒ–ä¸ºå‘Šè­¦æˆ–è¯Šæ–­ä¿¡æ¯ï¼Œä¸è¢«åå’½
- [ ] **æ–‡æ¡£é“¾æ¥**ï¼šè¯Šæ–­æŠ¥å‘Šä¸­åŒ…å«æŒ‡å‘å¯¹åº”å·¥ä½œæŒ‡å—çš„é“¾æ¥ï¼Œä¾¿äºå¿«é€ŸæŸ¥é˜…

---

---

## ä¾èµ–ç®¡ç†ä¸å®‰å…¨

### ä¾èµ–å†³ç­–æ¡†æ¶

**æ ¸å¿ƒåŸåˆ™**ï¼š**ç¬¬ä¸‰æ–¹ç»´æŠ¤çš„æˆç†Ÿåº“ä¼˜äºè‡ªå†™å®ç°**

åœ¨åŒç­‰åŠŸèƒ½ä¸‹ï¼Œåº”ä¼˜å…ˆé€‰æ‹©ï¼š
1. **ç¬¬ä¸€ä¼˜å…ˆ**ï¼šå®˜æ–¹åº“ï¼ˆSystem.* å‘½åç©ºé—´ï¼‰
2. **ç¬¬äºŒä¼˜å…ˆ**ï¼šç¬¬ä¸‰æ–¹æˆç†Ÿåº“ï¼ˆGitHub Star > 1Kï¼Œç¤¾åŒºæ´»è·ƒï¼Œæ–‡æ¡£å®Œæ•´ï¼‰
3. **ç¬¬ä¸‰ä¼˜å…ˆ**ï¼šè‡ªå†™å®ç°ï¼ˆä»…åœ¨æ— åˆé€‚ç¬¬ä¸‰æ–¹åº“æˆ–æœ‰ç‰¹æ®Šéœ€æ±‚æ—¶ï¼‰

**ç†ç”±**ï¼š
- ç¬¬ä¸‰æ–¹åº“ç”±ä¸“ä¸šå›¢é˜ŸæŒç»­ç»´æŠ¤ï¼Œè´¨é‡æ›´æœ‰ä¿éšœ
- å·²æœ‰å¤§é‡ä½¿ç”¨åœºæ™¯ï¼ŒBug ä¿®å¤æ›´åŠæ—¶
- å¼€ç®±å³ç”¨ï¼ˆOut-of-the-boxï¼‰ï¼Œæ— éœ€é‡å¤é€ è½®å­
- é™ä½æŠ€æœ¯å€ºç§¯ç´¯é£é™©

**ç¤ºä¾‹å¯¹æ¯”**ï¼š

| éœ€æ±‚ | å®˜æ–¹æ–¹æ¡ˆ | ç¬¬ä¸‰æ–¹æ–¹æ¡ˆ | é€‰æ‹© | åŸå›  |
|-----|--------|---------|------|------|
| è¯»å– PNG å›¾ç‰‡ä¿¡æ¯ | æ— ï¼ˆéœ€æ‰‹å†™äºŒè¿›åˆ¶è§£æï¼‰ | SixLabors.ImageSharp | âœ… ç¬¬ä¸‰æ–¹ | å¼€ç®±å³ç”¨ï¼Œå®Œæ•´åŠŸèƒ½ |
| å›¾ç‰‡æ ¼å¼è½¬æ¢ | æ—  | SixLabors.ImageSharp | âœ… ç¬¬ä¸‰æ–¹ | æ”¯æŒå¤šç§æ ¼å¼ï¼Œè´¨é‡ä¼˜ç§€ |
| è¯»å– Excel æ–‡ä»¶ | æ—  | ClosedXML | âœ… ç¬¬ä¸‰æ–¹ | åŠŸèƒ½å®Œæ•´ï¼Œæ–‡æ¡£ä¸°å¯Œ |
| æ–‡ä»¶ I/O | System.IO | (æ— éœ€ç¬¬ä¸‰æ–¹) | âœ… å®˜æ–¹ | å®˜æ–¹åº“å·²è¶³å¤Ÿ |
| JSON åºåˆ—åŒ– | System.Text.Json | Newtonsoft.Json | âœ… å®˜æ–¹/ç¬¬ä¸‰æ–¹ | ä¸¤è€…éƒ½å¯ï¼Œå®˜æ–¹å†…ç½®æ›´ç®€æ´ |

**è¯„ä¼°æ–°ä¾èµ–å‰ï¼Œå¿…é¡»å›ç­”ä»¥ä¸‹é—®é¢˜**ï¼š

| é—®é¢˜ | æƒé‡ | è¯„åˆ†æ–¹æ³• |
|-----|------|--------|
| 1. æ˜¯å¦å¿…éœ€ï¼Ÿèƒ½å¦ç”¨å®˜æ–¹åº“æ›¿ä»£ï¼Ÿ | 20% | æ˜¯(10åˆ†) / å¦(0åˆ†) |
| 2. åº“çš„æˆç†Ÿåº¦ä¸ç¤¾åŒºæ´»è·ƒåº¦ï¼Ÿ | 20% | GitHub Star > 1K(10) / 100-1K(8) / <100(5) |
| 3. æ˜¯å¦æœ‰å·²çŸ¥é«˜å±æ¼æ´ï¼Ÿ | 25% | æ— (10) / å·²ä¿®å¤(5) / æœªä¿®å¤(0) |
| 4. æ–‡æ¡£å®Œæ•´åº¦ä¸å¯ç»´æŠ¤æ€§ï¼Ÿ | 15% | å®Œæ•´(10) / ä¸€èˆ¬(5) / ç¼ºå¤±(0) |
| 5. ä¾èµ–æ ‘æ·±åº¦ä¸å¤æ‚åº¦ï¼Ÿ | 20% | ç›´æ¥ä¾èµ–(10) / 1å±‚(8) / 2+å±‚(5) |

**æ€»åˆ† â‰¥ 80** æ‰èƒ½å¼•å…¥ä¾èµ–ã€‚

---

### ä¾èµ–åº“åˆ†ç±»è§„èŒƒ

ä¸ºäº†ä¾¿äºåŒºåˆ†å’Œç»´æŠ¤ï¼Œæ‰€æœ‰å‡½æ•°å’Œæ–¹æ³•åº”æŒ‰ä½¿ç”¨çš„åº“è¿›è¡Œåˆ†ç±»æ ‡è®°ï¼š

| åˆ†ç±» | è¯´æ˜ | ç¤ºä¾‹ | ç»´æŠ¤è´£ä»» |
|-----|------|------|--------|
| **å®˜æ–¹** | .NET å®˜æ–¹åº“ï¼ˆSystem.* å‘½åç©ºé—´ï¼‰ | System.IO, System.Linq | Microsoft |
| **ç¬¬ä¸‰æ–¹** | ç”±ç¤¾åŒº/å…¬å¸ç»´æŠ¤çš„å¼€æºåº“ | SixLabors.ImageSharp, ClosedXML | åº“çš„ç»´æŠ¤è€… |
| **è‡ªå†™** | é¡¹ç›®å†…è‡ªè¡Œå®ç°çš„åŠŸèƒ½ | ConversionService, ValidationService | æœ¬é¡¹ç›®å›¢é˜Ÿ |

**åº“é€‰å‹ä¼˜å…ˆçº§**ï¼šå®˜æ–¹ > ç¬¬ä¸‰æ–¹ > è‡ªå†™

---

### ä¾èµ–ç‰ˆæœ¬é”å®š

```xml
<!-- csproj ä¸­å¿…é¡»æ˜ç¡®æŒ‡å®šç‰ˆæœ¬ -->
<ItemGroup>
  <PackageReference Include="SixLabors.ImageSharp" Version="3.1.11" />
  <PackageReference Include="SkiaSharp" Version="2.88.8" />
  <PackageReference Include="ClosedXML" Version="0.105.0" />
</ItemGroup>
```

### å®‰å…¨å®¡è®¡æ£€æŸ¥æ¸…å•

- [ ] æ˜¯å¦è¿è¡Œäº† `dotnet list package --vulnerable`ï¼Ÿ
- [ ] æ‰€æœ‰ä¾èµ–çš„è®¸å¯è¯æ˜¯å¦ç¬¦åˆé¡¹ç›®æ”¿ç­–ï¼ˆå¦‚ MITã€Apache 2.0ï¼‰ï¼Ÿ
- [ ] æ˜¯å¦æœ‰åºŸå¼ƒæˆ–åœæ­¢ç»´æŠ¤çš„åº“ï¼Ÿ
- [ ] NuGet åŒ…æ¥æºæ˜¯å¦å—ä¿¡ï¼Ÿï¼ˆåº”ä½¿ç”¨å®˜æ–¹ nuget.orgï¼‰
- [ ] æ˜¯å¦å®šæœŸæ£€æŸ¥ä¾èµ–æ›´æ–°ï¼Ÿï¼ˆå»ºè®®æ¯æœˆï¼‰

---

## å¤šäººåä½œæ ‡å‡†

### Git å·¥ä½œæµ

**åˆ†æ”¯ç­–ç•¥**ï¼šGit Flow

```
main (å‘å¸ƒåˆ†æ”¯) â† release/* â† develop â† feature/*, bugfix/*, hotfix/*
```

**åˆ†æ”¯å‘½å**ï¼š
- `feature/{åŠŸèƒ½å}` - æ–°åŠŸèƒ½å¼€å‘
- `bugfix/{Bugç¼–å·}` - Bug ä¿®å¤
- `hotfix/{ç¼–å·}` - ç´§æ€¥ä¿®å¤
- `release/{ç‰ˆæœ¬å·}` - å‘å¸ƒå‡†å¤‡
- `docs/{æ–‡æ¡£å}` - æ–‡æ¡£æ›´æ–°

**ç¤ºä¾‹**ï¼š
```
feature/ai-metadata-extraction
bugfix/ISSUE-42-image-conversion-fails
hotfix/security-patch-update-dependency
docs/architecture-redesign
```

### Commit æ¶ˆæ¯è§„èŒƒ

**æ ¼å¼**ï¼š`<type>(<scope>): <subject>`

```
type: feat | fix | docs | style | refactor | test | chore | perf
scope: å½±å“çš„æ¨¡å— (optional)
subject: 50 å­—ä»¥å†…ï¼Œå‘½ä»¤å¼ï¼Œé¦–å­—æ¯å°å†™

// ç¤ºä¾‹
feat(metadata): add AI prompt extraction from PNG tEXt

fix(converter): handle transparent PNG to JPEG conversion

docs: update architecture document with data flow diagrams

chore(deps): upgrade SixLabors.ImageSharp from 3.1.10 to 3.1.11
```

**å®Œæ•´ Commit æ¨¡æ¿**ï¼š
```
<type>(<scope>): <subject>

<body>

<footer>

// ä¾‹
feat(conversion): implement read-write-verify pattern

å°†æ‰€æœ‰å›¾ç‰‡è½¬æ¢æ“ä½œå‡çº§ä¸ºä¸‰æ­¥æ³•ï¼š
1. è¯»å–æºæ•°æ®ï¼ˆå›¾ç‰‡ã€å…ƒæ•°æ®ã€æ—¶é—´æˆ³ï¼‰
2. æ‰§è¡Œè½¬æ¢ï¼ˆæ ¼å¼è½¬æ¢ã€å…ƒæ•°æ®å†™å…¥ã€æ—¶é—´æˆ³åº”ç”¨ï¼‰
3. éªŒè¯ä¸€è‡´æ€§ï¼ˆé‡è¯»æ•°æ®ï¼Œç¡®ä¿è½¬æ¢æ— æŸï¼‰

è¯¥æ¨¡å¼ç¡®ä¿æ•°æ®å®Œæ•´æ€§ï¼Œä¾¿äºäº‹åå®¡è®¡ã€‚

Closes #123
```

### Pull Request è§„èŒƒ

**PR æ ‡é¢˜**ï¼šéµå¾ª Commit è§„èŒƒ  
**PR æè¿°æ¨¡æ¿**ï¼š

```markdown
## å˜æ›´å†…å®¹
æè¿°æœ¬ PR åšäº†ä»€ä¹ˆï¼ˆ3-5 å¥è¯ï¼‰

## å…³è” Issue
Closes #123

## æµ‹è¯•æ–¹æ³•
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] é›†æˆæµ‹è¯•é€šè¿‡
- [ ] æ‰‹åŠ¨æµ‹è¯•åœºæ™¯ï¼š...

## æ£€æŸ¥æ¸…å•
- [ ] ä»£ç éµå¾ªé£æ ¼æŒ‡å—
- [ ] è‡ªè¡Œ review è¿‡ä»£ç 
- [ ] æ·»åŠ äº†å¿…è¦çš„æ³¨é‡Šä¸æ–‡æ¡£
- [ ] æ–°å¢å‡½æ•°æœ‰ XML æ³¨é‡Š
- [ ] æ— æ–°çš„ warning æˆ– error
- [ ] æµ‹è¯•è¦†ç›–ç‡æœªä¸‹é™

## å½±å“èŒƒå›´
- æ¨¡å—ï¼šFileScanner, ImageConverter
- ä¾èµ–å˜æ›´ï¼šæ— 
- ç ´åæ€§å˜æ›´ï¼šå¦
```

### Code Review æ£€æŸ¥æ¸…å•

**Reviewer å¿…é¡»éªŒè¯**ï¼š

- [ ] **éœ€æ±‚åŒ¹é…**ï¼šä»£ç æ˜¯å¦å®ç°äº†å¯¹åº”éœ€æ±‚ï¼Ÿ
- [ ] **è®¾è®¡ä¸€è‡´**ï¼šæ˜¯å¦éµå¾ªäº†æ¶æ„æ–‡æ¡£çš„è®¾è®¡ï¼Ÿ
- [ ] **å•ä¸€èŒè´£**ï¼šæ˜¯å¦è¿åäº† SRPï¼Ÿ
- [ ] **å¤æ‚åº¦**ï¼šæ˜¯å¦è¶…è¿‡äº†è§„å®šçš„å¤æ‚åº¦é™åˆ¶ï¼Ÿ
- [ ] **å¼‚å¸¸å¤„ç†**ï¼šæ˜¯å¦æ­£ç¡®æ•è·å’Œè®°å½•å¼‚å¸¸ï¼Ÿ
- [ ] **æ–‡æ¡£æ³¨é‡Š**ï¼šæ˜¯å¦æœ‰å®Œæ•´çš„ XML æ³¨é‡Šï¼Ÿ
- [ ] **æµ‹è¯•è¦†ç›–**ï¼šæ˜¯å¦æœ‰ç›¸åº”çš„å•å…ƒæµ‹è¯•ï¼Ÿ
- [ ] **å‘½åè§„èŒƒ**ï¼šæ˜¯å¦éµå¾ªäº†å‘½åçº¦å®šï¼Ÿ
- [ ] **å®‰å…¨é£é™©**ï¼šæ˜¯å¦æœ‰æ³¨å…¥ã€æº¢å‡ºç­‰é£é™©ï¼Ÿ
- [ ] **æ€§èƒ½å½±å“**ï¼šæ˜¯å¦å¼•å…¥äº†æ€§èƒ½åŠ£åŒ–ï¼Ÿ
- [ ] **SOLID åŸåˆ™**ï¼šæ˜¯å¦è¿åäº†ä»»ä½• SOLID åŸåˆ™ï¼Ÿ

---

## é¢„æµ‹æŠ¥å‘Šä¸é£é™©ç®¡ç†

### é¡¹ç›®é£é™©è¯„ä¼°æŠ¥å‘Š (Risk Assessment Report)

**æ›´æ–°å‘¨æœŸ**ï¼šæ¯æœˆæˆ–æ¶æ„è°ƒæ•´æ—¶

#### æŠ¥å‘Šç»“æ„

```markdown
# é¡¹ç›®é£é™©è¯„ä¼°æŠ¥å‘Š

## 1. é¡¹ç›®å…ƒæ•°æ®
- é¡¹ç›®åï¼šImageInfo
- è¯„ä¼°æ—¥æœŸï¼š2025-11-16
- è¯„ä¼°äººï¼š[å›¢é˜Ÿæˆå‘˜]
- å¤æ‚åº¦æŒ‡æ•° (CCI)ï¼š42ï¼ˆä¸­ç­‰é£é™©ï¼‰

## 2. é£é™©æ¸…å•

| ID | é£é™©ç±»åˆ« | æè¿° | å½±å“ | å¯èƒ½æ€§ | ä¼˜å…ˆçº§ | ç¼“è§£æªæ–½ |
|----|--------|------|------|------|------|--------|
| R001 | ä¾èµ–æ¼æ´ | ImageSharp å¯èƒ½å­˜åœ¨å·²çŸ¥æ¼æ´ | é«˜ | ä¸­ | P1 | æ¯æœˆè¿è¡Œ vulnerability check |
| R002 | å…ƒæ•°æ®æ³„éœ² | PNG/EXIF/XMP åŒ…å«æ•æ„Ÿä¿¡æ¯ | é«˜ | ä¸­ | P1 | æ·»åŠ è„±æ•/è¿‡æ»¤é€‰é¡¹ |
| R003 | æ–‡ä»¶ç³»ç»Ÿæƒé™ | æ— æƒé™è®¿é—®ç›®å½•å¯¼è‡´æ‰«æå¤±è´¥ | ä¸­ | ä¸­ | P2 | æ”¹è¿›å¼‚å¸¸å¤„ç†ä¸æ—¥å¿— |
| R004 | å†…å­˜æº¢å‡º | å¤§å›¾ç‰‡æˆ–å¤§é‡å°å›¾ç‰‡å¯¼è‡´ OOM | ä¸­ | ä½ | P2 | æ·»åŠ å†…å­˜é™åˆ¶ä¸æµå¼å¤„ç† |
| R005 | æ ¼å¼è½¬æ¢å¤±è´¥ | æŸåæˆ–ä¸æ”¯æŒçš„å›¾ç‰‡æ ¼å¼ | ä¸­ | ä¸­ | P2 | å®Œå–„ ValidateConversion |

## 3. ä¾èµ–å®‰å…¨æ€§åˆ†æ

### å½“å‰ä¾èµ–æ¸…å•
- SixLabors.ImageSharp 3.1.11ï¼šæ— å·²çŸ¥é«˜å±æ¼æ´ï¼ˆæˆªè‡³ 2025-11-16ï¼‰
- SkiaSharp 2.88.8ï¼šæ— å·²çŸ¥é«˜å±æ¼æ´
- ClosedXML 0.105.0ï¼š2 ä¸ª Low çº§åˆ« CVEï¼Œå·²ä¿®å¤
- MetadataExtractor 2.5.0ï¼šæ— å·²çŸ¥æ¼æ´

### æ¼æ´æ£€æŸ¥ç»“æœ
```
dotnet list package --vulnerable
No vulnerable packages detected (æœ€åæ£€æŸ¥æ—¥æœŸ)
```

## 4. ä»£ç è´¨é‡æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å½“å‰å€¼ | çŠ¶æ€ |
|-----|------|------|------|
| æµ‹è¯•è¦†ç›–ç‡ | 70% | 72% | âœ… è¾¾æ ‡ |
| åœˆå¤æ‚åº¦å¹³å‡ | < 10 | 8.5 | âœ… è¾¾æ ‡ |
| ä»£ç è¡Œæ•° | < 10K | 2.8K | âœ… è¾¾æ ‡ |
| ä¾èµ–æ•°é‡ | < 10 | 5 | âœ… è¾¾æ ‡ |
| æ–‡æ¡£å®Œæ•´åº¦ | 100% | 95% | âš ï¸ ç¼ºå°‘ 1 ä¸ªæ–‡æ¡£ |

## 5. ç»´æŠ¤æ€§è¯„ä¼°

- ä»£ç å¯è¯»æ€§ï¼šé«˜ï¼ˆæ¨¡å—åŒ–è®¾è®¡ã€å……åˆ†æ³¨é‡Šï¼‰
- å­¦ä¹ æ›²çº¿ï¼šä½ï¼ˆæ¶æ„ç®€æ´ï¼Œ5 ä¸ªæ ¸å¿ƒæ¨¡å—ï¼‰
- æ‰©å±•æ€§ï¼šä¸­ï¼ˆéœ€è¦æ”¹è¿› Interface æŠ½è±¡å±‚ï¼‰
- æŠ€æœ¯å€ºï¼šä½ï¼ˆæ— å·²çŸ¥æŠ€æœ¯å€ºï¼‰

## 6. ä¸‰ä¸ªæœˆé¢„æµ‹

### å¯èƒ½é‡åˆ°çš„é—®é¢˜
1. **AI å…ƒæ•°æ®æ ‡å‡†å¤šå…ƒåŒ–**ï¼šSD WebUI / ComfyUI / Midjourney ç­‰å·¥å…·å…ƒæ•°æ®æ ¼å¼å·®å¼‚
   - å½±å“ï¼šextraction å‡½æ•°å¤æ‚åº¦ä¸Šå‡
   - ç¼“è§£ï¼šè®¾è®¡ Plugin æ¶æ„ç”¨äºæ”¯æŒå¤šç§æ ¼å¼

2. **å¤§è§„æ¨¡æ‰¹å¤„ç†**ï¼šå¤„ç† 10K+ å¼ å›¾ç‰‡æ—¶å¯èƒ½é‡åˆ°æ€§èƒ½æˆ–å†…å­˜é—®é¢˜
   - å½±å“ï¼šéœ€è¦ä¼˜åŒ–è½¬æ¢æµç¨‹ã€å®ç°æµå¼å¤„ç†
   - ç¼“è§£ï¼šæ·»åŠ æ€§èƒ½åŸºå‡†æµ‹è¯•ã€å¹¶è¡Œå¤„ç†

3. **è·¨å¹³å°å…¼å®¹æ€§**ï¼šWindows/Linux/macOS æ–‡ä»¶æ—¶é—´æˆ³å¤„ç†å·®å¼‚
   - å½±å“ï¼šæŸäº›å¹³å°æ— æ³•è®¾ç½®åˆ›å»ºæ—¶é—´
   - ç¼“è§£ï¼šæ–‡æ¡£åŒ–å¹³å°é™åˆ¶ï¼Œæä¾›æœ€ä½³å®è·µ

### å»ºè®®è¡ŒåŠ¨é¡¹
- [ ] å»ºç«‹ä¾èµ–æ›´æ–°è®¡åˆ’ï¼ˆæ¯æœˆæ£€æŸ¥ä¸€æ¬¡ï¼‰
- [ ] æ·»åŠ æ€§èƒ½åŸºå‡†æµ‹è¯•ï¼ˆå›¾ç‰‡è½¬æ¢é€Ÿåº¦ã€å†…å­˜å³°å€¼ï¼‰
- [ ] åˆ›å»º Roadmapï¼ˆæ”¯æŒæ›´å¤šå…ƒæ•°æ®æ ¼å¼ã€å¤§è§„æ¨¡æ‰¹å¤„ç†ä¼˜åŒ–ï¼‰
- [ ] å®šæœŸä»£ç å®¡è®¡ï¼ˆæ¯å­£åº¦ä¸€æ¬¡ï¼‰
```

### é£é™©åˆ†ç±»ä¸åº”å¯¹

**é£é™©ç±»åˆ«**ï¼š

1. **æŠ€æœ¯é£é™©**
   - ä¾èµ–æ¼æ´ã€æ€§èƒ½ç“¶é¢ˆã€å…¼å®¹æ€§é—®é¢˜
   - åº”å¯¹ï¼šå®šæœŸå®¡è®¡ã€æ€§èƒ½æµ‹è¯•ã€è·¨å¹³å°æµ‹è¯•

2. **ä¸šåŠ¡é£é™©**
   - éœ€æ±‚å˜æ›´ã€ä¼˜å…ˆçº§è°ƒæ•´ã€èŒƒå›´è”“å»¶
   - åº”å¯¹ï¼šéœ€æ±‚è¯„å®¡ã€æ˜ç¡®èŒƒå›´è¾¹ç•Œã€å˜æ›´æ§åˆ¶

3. **è¿ç»´é£é™©**
   - éƒ¨ç½²é—®é¢˜ã€ç›‘æ§ç›²åŒºã€æ¢å¤å›°éš¾
   - åº”å¯¹ï¼šè‡ªåŠ¨åŒ–éƒ¨ç½²ã€è¯¦ç»†æ–‡æ¡£ã€ç¾éš¾æ¢å¤è®¡åˆ’

4. **äººå‘˜é£é™©**
   - çŸ¥è¯†é›†ä¸­ã€äººåŠ›ä¸è¶³ã€æŠ€èƒ½ç¼ºé™·
   - åº”å¯¹ï¼šçŸ¥è¯†å…±äº«ã€äº¤å‰åŸ¹è®­ã€æ–‡æ¡£å®Œå–„

### é£é™©è¯„åˆ†çŸ©é˜µ

```
     å¯èƒ½æ€§ (Likelihood)
     â”‚ ä½   â”‚ ä¸­   â”‚ é«˜   â”‚
å½±å“ â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
     â”‚ ä½  â”‚ä½   â”‚ä½   â”‚ä¸­  â”‚
     â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
     â”‚ ä¸­  â”‚ä½   â”‚ä¸­   â”‚é«˜  â”‚
     â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
     â”‚ é«˜  â”‚ä¸­   â”‚é«˜   â”‚æé«˜â”‚
     â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜

P1(ä¼˜å…ˆçº§ 1)ï¼šé«˜ä¼˜å…ˆçº§ï¼Œéœ€ç«‹å³å¤„ç†
P2(ä¼˜å…ˆçº§ 2)ï¼šä¸­ä¼˜å…ˆçº§ï¼Œä¸‹ä¸ªè¿­ä»£å¤„ç†
P3(ä¼˜å…ˆçº§ 3)ï¼šä½ä¼˜å…ˆçº§ï¼Œå¯å»¶åå¤„ç†
```

---

## æ—¶é—´æˆ³ä¸æ—¥å¿—è§„èŒƒ

### æŠ¥å‘Šç”Ÿæˆçš„æ—¶é—´æˆ³è§„èŒƒ

æ‰€æœ‰è¾“å‡ºæŠ¥å‘Šå¿…é¡»åŒ…å«æ—¶é—´æˆ³ï¼Œä»¥å¢å¼ºå”¯ä¸€æ€§å’Œå¯è¿½æº¯æ€§ã€‚

#### æŠ¥å‘Šå‘½åè§„èŒƒ

**æ ¼å¼**ï¼š`{æŠ¥å‘Šåç§°}-{yyyyMMdd-HHmmss}.{æ‰©å±•å}`

**ç¤ºä¾‹**ï¼š
```
conversion-report-20251116-143022.xlsx      // è½¬æ¢æŠ¥å‘Š
conversion-log-20251116-143022.txt          // è½¬æ¢æ—¥å¿—
export-20251116-083015.csv                  // å¯¼å‡ºæ•°æ®
backup-20251115-220030.zip                  // å¤‡ä»½æ–‡ä»¶
performance-metrics-20251116-120000.json    // æ€§èƒ½æŠ¥å‘Š
```

#### æ—¶é—´æˆ³æ ¼å¼

| ç”¨é€” | æ ¼å¼ | ç¤ºä¾‹ | è¯´æ˜ |
|-----|------|------|------|
| æ–‡ä»¶å | `yyyyMMdd-HHmmss` | `20251116-143022` | ç´§å‡‘æ˜“è¯»ï¼Œç”¨äºæ’åº |
| æ–‡ä»¶å†…å®¹ | ISO 8601 | `2025-11-16T14:30:22Z` | æ ‡å‡†æ ¼å¼ï¼Œä¾¿äºè§£æ |
| æ—¥å¿—è¡Œ | `yyyy-MM-dd HH:mm:ss` (UTC) | `2025-11-16 14:30:22` | å¯è¯»æ€§å¼ºï¼Œä¾¿äºäººå·¥æŸ¥çœ‹ |
| æ•°æ®åº“/API | ISO 8601 | `2025-11-16T14:30:22.123Z` | åŒ…å«æ¯«ç§’ï¼Œç²¾åº¦æœ€é«˜ |

**æ—¶åŒºè§„èŒƒ**ï¼š
- æ‰€æœ‰æ—¶é—´æˆ³ç»Ÿä¸€ä½¿ç”¨ **UTC**ï¼ˆåè°ƒä¸–ç•Œæ—¶ï¼‰ï¼Œä¸ä½¿ç”¨æœ¬åœ°æ—¶é—´
- æ–‡ä»¶åä¸­ä¸éœ€æ˜ç¡®æ ‡è®° UTCï¼Œå› ä¸ºå…¨çƒç»Ÿä¸€
- æ–‡ä»¶å†…å®¹ä¸­å¯é€‰ç”¨ `Z` åç¼€ï¼ˆè¡¨ç¤º UTCï¼‰æˆ–æ˜ç¡®æ ‡æ³¨ `(UTC)`

### æ—¥å¿—æ–‡ä»¶è§„èŒƒ

#### æ—¥å¿—æ–‡ä»¶ä½ç½®ä¸ç»„ç»‡

**ä½ç½®**ï¼šé¡¹ç›®è¾“å‡ºç›®å½•ä¸‹ç»Ÿä¸€åˆ›å»º `logs/` å­ç›®å½•

```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ outputs/
â”‚   â”œâ”€â”€ converted/           (è½¬æ¢åçš„å›¾ç‰‡)
â”‚   â”œâ”€â”€ conversion-report-20251116-143022.xlsx
â”‚   â”œâ”€â”€ conversion-log.txt   (è¿½åŠ å¼æ—¥å¿—ï¼Œæ‰€æœ‰è½¬æ¢çš„ç´¯ç§¯è®°å½•)
â”‚   â””â”€â”€ logs/                (æŒ‰æ—¥æœŸåˆ†ç±»çš„å½’æ¡£æ—¥å¿—)
â”‚       â”œâ”€â”€ conversion-2025-11-16.log
â”‚       â”œâ”€â”€ conversion-2025-11-15.log
â”‚       â””â”€â”€ error-2025-11-16.log
```

#### æ—¥å¿—æ ¼å¼è§„èŒƒ

**æ ‡å‡†æ—¥å¿—è¡Œæ ¼å¼**ï¼ˆStructured Loggingï¼‰ï¼š

```
[æ—¶é—´æˆ³] [æ—¥å¿—çº§åˆ«] [æ¨¡å—] [æ“ä½œID] æ¶ˆæ¯ [å¼‚å¸¸å †æ ˆ]

ä¾‹ï¼š
[2025-11-16 14:30:22] [INFO] [ConversionService] [OP-12345] å¼€å§‹æ‰«æç›®å½•: C:\\images
[2025-11-16 14:30:23] [INFO] [ImageConverter] [OP-12345] è½¬æ¢æˆåŠŸ: input.png â†’ output.jpg (å®½=800, é«˜=600)
[2025-11-16 14:30:24] [WARN] [AIMetadataExtractor] [OP-12345] å…ƒæ•°æ®å­—æ®µè¿‡é•¿ï¼Œå·²æˆªæ–­: Prompt (åŸé•¿=5000 å­—ç¬¦)
[2025-11-16 14:30:25] [ERROR] [ValidationService] [OP-12345] è½¬æ¢éªŒè¯å¤±è´¥: ç›®æ ‡æ–‡ä»¶å®½åº¦ä¸åŒ¹é… (æœŸæœ›=800, å®é™…=795)
```

#### æ—¥å¿—çº§åˆ«

| çº§åˆ« | ç”¨é€” | ç¤ºä¾‹ |
|-----|------|------|
| **DEBUG** | å¼€å‘è°ƒè¯•ä¿¡æ¯ï¼ŒåŒ…å«è¯¦ç»†çš„çŠ¶æ€å˜åŒ– | å‡½æ•°å…¥å‚ã€ä¸­é—´å˜é‡å€¼ã€å¾ªç¯æ¬¡æ•° |
| **INFO** | ä¸šåŠ¡è¿›åº¦ä¿¡æ¯ï¼Œè®°å½•ä¸»è¦æ“ä½œ | æ–‡ä»¶å¼€å§‹å¤„ç†ã€è½¬æ¢æˆåŠŸã€ç”ŸæˆæŠ¥å‘Š |
| **WARN** | è­¦å‘Šä¿¡æ¯ï¼Œè¡¨ç¤ºæ½œåœ¨é—®é¢˜ä½†ä¸å½±å“ç»§ç»­æ‰§è¡Œ | å…ƒæ•°æ®æˆªæ–­ã€å…¼å®¹æ€§æç¤ºã€æ€§èƒ½å»ºè®® |
| **ERROR** | é”™è¯¯ä¿¡æ¯ï¼Œè¡¨ç¤ºå•æ¬¡æ“ä½œå¤±è´¥ä½†ç¨‹åºç»§ç»­ | è½¬æ¢å¤±è´¥ã€æ–‡ä»¶æ— æ³•åŠ è½½ã€æƒé™ä¸è¶³ |
| **FATAL** | è‡´å‘½é”™è¯¯ï¼Œè¡¨ç¤ºç¨‹åºæ— æ³•ç»§ç»­æ‰§è¡Œ | æ ¸å¿ƒä¾èµ–åŠ è½½å¤±è´¥ã€èµ„æºè€—å°½ã€æ— æ³•æ¢å¤ |

#### æ¯æ¬¡è¿è¡Œçš„æŠ¥å‘Šå°ç»“

æ¯æ¬¡è½¬æ¢/å¤„ç†æ“ä½œå®Œæˆåï¼Œæ—¥å¿—åº”åŒ…å«ç»Ÿè®¡æ‘˜è¦ï¼š

```
================================================================================
æŠ¥å‘Šç”Ÿæˆæ—¶é—´: 2025-11-16 14:30:30 (UTC)
æŠ¥å‘Šæ–‡ä»¶: conversion-report-20251116-143022.xlsx
æ“ä½œæ€»æ•°: 150
æˆåŠŸæ•°: 148
å¤±è´¥æ•°: 2
æˆåŠŸç‡: 98.67%
å¤„ç†è€—æ—¶: 45.3 ç§’
å¹³å‡å•å›¾å¤„ç†: 0.30 ç§’

å¤±è´¥è¯¦æƒ…:
  - image_001.png: æ ¼å¼ä¸æ”¯æŒ (GIF animated)
  - image_042.jpg: æ–‡ä»¶æŸå (truncated JPEG)
================================================================================
```

### æ–‡ä»¶æ—¶é—´æˆ³ä¸è¿½æº¯

#### å…ƒæ•°æ®ä¸­çš„æ—¶é—´æˆ³å­—æ®µ

åœ¨æ‰€æœ‰é‡è¦æ“ä½œè®°å½•ä¸­åº”åŒ…å«æ—¶é—´æˆ³å­—æ®µï¼Œä¾¿äºäº‹åè¿½è¸ªï¼š

| å­—æ®µ | å«ä¹‰ | æ ¼å¼ | ç”¨é€” |
|-----|------|------|------|
| `CreatedAt` | æ“ä½œè®°å½•çš„åˆ›å»ºæ—¶é—´ | ISO 8601 | ç¡®å®šä½•æ—¶æ‰§è¡Œäº†è¯¥æ“ä½œ |
| `UpdatedAt` | æœ€åä¿®æ”¹æ—¶é—´ | ISO 8601 | è¿½è¸ªç»´æŠ¤å†å² |
| `SourceModifiedUtc` | æºæ–‡ä»¶ä¿®æ”¹æ—¶é—´ | ISO 8601 | æºæ•°æ®ç‰ˆæœ¬æ ‡è¯† |
| `ReportTimestamp` | æŠ¥å‘Šç”Ÿæˆæ—¶é—´ | ISO 8601 | å¯¹åº”æŠ¥å‘Šæ‰€å±çš„"å¿«ç…§" |
| `ExpiryAt` (å¯é€‰) | æ•°æ®è¿‡æœŸæ—¶é—´ | ISO 8601 | ç”¨äºè‡ªåŠ¨æ¸…ç†ä¸´æ—¶æ•°æ® |

#### æ—¶é—´æˆ³ä¸€è‡´æ€§åŸåˆ™

- **åŸå­æ€§**ï¼šå•ä¸ªæ“ä½œçš„æ‰€æœ‰æ—¶é—´æˆ³åº”åœ¨ 1 ç§’å†…å®Œæˆï¼Œå¦åˆ™åº”ç»Ÿä¸€ä½¿ç”¨æ“ä½œå¼€å§‹æ—¶é—´
- **è¿ç»­æ€§**ï¼šåŒä¸€æŠ¥å‘Šä¸­çš„æ‰€æœ‰è¡Œä½¿ç”¨ç›¸åŒçš„ `ReportTimestamp`ï¼Œä»¥è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª"å¿«ç…§"
- **ç²¾åº¦**ï¼šæ–‡ä»¶ç³»ç»Ÿæ—¶é—´ç²¾åº¦é€šå¸¸ä¸º 1 ç§’ï¼Œä¸è¿½æ±‚æ¯«ç§’çº§åˆ«ï¼ˆé™¤éç³»ç»Ÿæ˜ç¡®æ”¯æŒï¼‰

### æ—¶æ•ˆæ€§æ•°æ®çš„æ¸…ç†è§„èŒƒ

å¯¹äºæœ‰æ˜æ˜¾æ—¶æ•ˆæ€§çš„æ–‡ä»¶ï¼ˆä¸´æ—¶æŠ¥å‘Šã€æ—¥å¿—ã€ç¼“å­˜ï¼‰ï¼Œåº”å®æ–½è‡ªåŠ¨æ¸…ç†ï¼š

```csharp
/// <summary>
/// æ¸…ç†è¶…è¿‡æŒ‡å®šå¤©æ•°çš„è¿‡æœŸæŠ¥å‘Šå’Œæ—¥å¿—æ–‡ä»¶ã€‚
/// </summary>
public static void CleanupOldReports(string outputDir, int retentionDays = 30)
{
    var cutoffDate = DateTime.UtcNow.AddDays(-retentionDays);
    var files = Directory.GetFiles(outputDir, "*-????????-??????.*");
    
    foreach (var file in files)
    {
        // ä»æ–‡ä»¶åæå–æ—¶é—´æˆ³
        if (TryExtractTimestamp(file, out var timestamp) && timestamp < cutoffDate)
        {
            File.Delete(file);
            Console.WriteLine($"Deleted old report: {file}");
        }
    }
}
```

**æ¸…ç†è§„èŒƒ**ï¼š
- å¼€å‘/æµ‹è¯•ç¯å¢ƒï¼šä¿ç•™ 7 å¤©
- ç”Ÿäº§ç¯å¢ƒï¼šä¿ç•™ 30-90 å¤©ï¼ˆæ ¹æ®æ³•è§„è¦æ±‚ï¼‰
- æ•æ„Ÿæ•°æ®ï¼šä¿ç•™æœŸé™åº”éµå¾ªéšç§æ”¿ç­–
- å®šæœŸæ¸…ç†ï¼šæ¯å‘¨è¿è¡Œä¸€æ¬¡ï¼ˆå¦‚åœ¨ CI/CD ä¸­å®ç°ï¼‰

### é¡¹ç›®çº²é¢†ä¸­çš„ç¤ºä¾‹

**æœ¬é¡¹ç›®çš„æ—¶é—´æˆ³å®è£…**ï¼š

é¡¹ç›® `ImageInfo` å·²å®ç°ä»¥ä¸‹è§„èŒƒï¼š
- âœ… æŠ¥å‘Šæ–‡ä»¶åï¼š`conversion-report-{yyyyMMdd-HHmmss}.xlsx`
- âœ… æ—¥å¿—æ–‡ä»¶ï¼š`conversion-log.txt`ï¼ˆè¿½åŠ å¼ï¼Œæ¯è¡ŒåŒ…å«æ—¶é—´æˆ³ï¼‰
- âœ… æ¯è¡Œè½¬æ¢è®°å½•é™„åŠ  `ReportTimestamp` å­—æ®µï¼ˆISO 8601ï¼‰
- âœ… æ—¥å¿—æ‘˜è¦ï¼šåŒ…å«ç»Ÿè®¡æ•°æ®å’Œå¤±è´¥åŸå› åˆ†æ
- âœ… å•å…ƒæ ¼æˆªæ–­ï¼šé•¿åº¦è¶…è¿‡ 1000 å­—ç¬¦çš„å­—æ®µè‡ªåŠ¨æˆªæ–­å¹¶æ ‡æ³¨çœç•¥å·ï¼Œé¿å… XLSX å•å…ƒæ ¼è¶…é™é”™è¯¯

#### æ–‡ä»¶æ—¶é—´æˆ³è®¾ç½®çš„å¹³å°é™åˆ¶

**ä¿®æ”¹æ—¶é—´ï¼ˆLastWriteTimeUtcï¼‰**ï¼š
- âœ… Windowsï¼šå®Œå…¨æ”¯æŒ
- âœ… Linuxï¼šå®Œå…¨æ”¯æŒ
- âœ… macOSï¼šå®Œå…¨æ”¯æŒ

**åˆ›å»ºæ—¶é—´ï¼ˆCreationTimeUtcï¼‰**ï¼š
- âš ï¸ Windowsï¼šéœ€è¦ P/Invokeï¼Œå½“å‰æœªå®ç°
- âŒ Linuxï¼šæ–‡ä»¶ç³»ç»Ÿä¸æ”¯æŒï¼ˆext4ã€XFS ç­‰æ— åˆ›å»ºæ—¶é—´æ¦‚å¿µï¼‰
- âŒ macOSï¼šæ–‡ä»¶ç³»ç»Ÿä¸æ”¯æŒï¼ˆHFS+ çš„"åˆ›å»ºæ—¥æœŸ"ä¸ä¿®æ”¹æ—¶é—´é€šå¸¸ç›¸åŒï¼‰

**å»ºè®®**ï¼š
- ç”Ÿäº§ç¯å¢ƒè‹¥éœ€è·¨å¹³å°ä¿è¯ï¼Œä»…ä¾èµ– `LastWriteTimeUtc`
- è‹¥éœ€ Windows åˆ›å»ºæ—¶é—´ï¼Œé€šè¿‡ P/Invoke æ‰©å±• `TrySetCreationTime()` æ–¹æ³•
- éªŒè¯æ—¶å…è®¸ Â±2 ç§’å®¹å·®ï¼Œåº”å¯¹æ“ä½œç³»ç»Ÿå»¶è¿Ÿ

---

## å‘å¸ƒä¸ç»´æŠ¤æµç¨‹

### ç‰ˆæœ¬ç®¡ç†

**ç‰ˆæœ¬æ ¼å¼**ï¼šSemantic Versioning (SemVer)  
`MAJOR.MINOR.PATCH` (å¦‚ `1.2.3`)

- **MAJOR**ï¼šä¸å…¼å®¹ API æ›´æ”¹
- **MINOR**ï¼šå‘åå…¼å®¹çš„æ–°åŠŸèƒ½
- **PATCH**ï¼šå‘åå…¼å®¹çš„ Bug ä¿®å¤

**ç¤ºä¾‹**ï¼š
- `1.0.0` - é¦–ä¸ªå‘å¸ƒç‰ˆæœ¬
- `1.1.0` - æ–°å¢ AI å…ƒæ•°æ®æå–åŠŸèƒ½
- `1.1.1` - ä¿®å¤ WebP è½¬æ¢ Bug
- `2.0.0` - é‡æ„æ¶æ„ï¼Œä¸å…¼å®¹ 1.x

### å‘å¸ƒæ£€æŸ¥æ¸…å•

**å‘å¸ƒå‰ï¼ˆPre-Releaseï¼‰**ï¼š

- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆ`dotnet test`ï¼‰
- [ ] ä»£ç å®¡æŸ¥å®Œæˆ
- [ ] CHANGELOG æ›´æ–°
- [ ] ç‰ˆæœ¬å·æ›´æ–°ï¼ˆcsproj + æ ‡ç­¾ï¼‰
- [ ] æ–‡æ¡£æ›´æ–°ï¼ˆREADMEã€API æ–‡æ¡£ï¼‰
- [ ] ä¾èµ–å®¡è®¡ï¼ˆ`dotnet list package --vulnerable`ï¼‰
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡
- [ ] å®‰å…¨å®¡æŸ¥é€šè¿‡

**å‘å¸ƒæµç¨‹**ï¼š

```bash
# 1. åˆ›å»º release åˆ†æ”¯
git checkout -b release/v1.1.0 develop

# 2. æ›´æ–°ç‰ˆæœ¬å·
# ç¼–è¾‘ src/ImageInfo/ImageInfo.csproj: <Version>1.1.0</Version>

# 3. æäº¤å˜æ›´
git commit -m "chore: bump version to 1.1.0"

# 4. åˆ›å»º Pull Requestï¼ˆrelease â†’ mainï¼‰
git push origin release/v1.1.0

# 5. Code Review & Merge
# ... GitHub Actions è‡ªåŠ¨æµ‹è¯• ...

# 6. æ‰“æ ‡ç­¾
git tag -a v1.1.0 -m "Release version 1.1.0"
git push origin v1.1.0

# 7. å‘å¸ƒ NuGet åŒ…ï¼ˆå¦‚é€‚ç”¨ï¼‰
# dotnet pack ...

# 8. åˆ›å»º Release Notes
# GitHub Releases â†’ ä» CHANGELOG ç”Ÿæˆ
```

### ç»´æŠ¤å‘¨æœŸ

| æ´»åŠ¨ | é¢‘ç‡ | è´£ä»»äºº |
|-----|------|------|
| ä¾èµ–æ£€æŸ¥ | æ¯æœˆ | DevOps / Lead |
| ä»£ç å®¡è®¡ | æ¯å­£åº¦ | æ¶æ„å¸ˆ |
| æ€§èƒ½æµ‹è¯• | æ¯åŠå¹´ | Performance å›¢é˜Ÿ |
| å®‰å…¨å®¡è®¡ | æ¯å¹´ | å®‰å…¨å›¢é˜Ÿ |
| æ–‡æ¡£æ›´æ–° | å®æ—¶ | å¼€å‘è€… |

---

## æ£€æŸ¥æ¸…å•

### é¡¹ç›®å¯åŠ¨æ£€æŸ¥æ¸…å•

- [ ] éœ€æ±‚æ–‡æ¡£å®Œæˆï¼ˆRDD / User Storiesï¼‰
- [ ] æ¶æ„æ–‡æ¡£è‰ç¨¿å°±ç»ªï¼ˆADDï¼‰
- [ ] æŠ€æœ¯æ ˆé€‰å‹å®Œæˆï¼ˆä¾èµ–è¯„åˆ† â‰¥ 80ï¼‰
- [ ] å¼€å‘ç¯å¢ƒé…ç½®æŒ‡å—ç¼–å†™
- [ ] åˆå§‹ Git ä»“åº“ä¸åˆ†æ”¯ç­–ç•¥å»ºç«‹
- [ ] CI/CD ç®¡é“é…ç½®ï¼ˆå¦‚é€‚ç”¨ï¼‰
- [ ] æˆå‘˜æƒé™ä¸æ²Ÿé€šæ¸ é“ç¡®è®¤

### ä»£ç æäº¤æ£€æŸ¥æ¸…å•

æäº¤ä»£ç å‰ï¼Œå¿…é¡»æ£€æŸ¥ï¼š

- [ ] ä»£ç æœ¬åœ°ç¼–è¯‘é€šè¿‡ï¼ˆ`dotnet build`ï¼‰
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆ`dotnet test`ï¼‰
- [ ] ä»£ç é£æ ¼ç¬¦åˆè§„èŒƒï¼ˆå‘½åã€å¤æ‚åº¦ã€ç¼©è¿›ï¼‰
- [ ] æ·»åŠ äº† XML æ–‡æ¡£æ³¨é‡Šï¼ˆå…¬å¼€ APIï¼‰
- [ ] å¼‚å¸¸å¤„ç†å®Œå–„ï¼ˆæ— è£¸ try-catchï¼‰
- [ ] æ–°å¢çš„ç¬¬ä¸‰æ–¹ä¾èµ–ç»è¿‡è¯„åˆ†ï¼ˆâ‰¥ 80ï¼‰
- [ ] ç›¸å…³æ–‡æ¡£å·²æ›´æ–°
- [ ] Commit æ¶ˆæ¯éµå¾ªæ ¼å¼è§„èŒƒ
- [ ] æ— è°ƒè¯•ä»£ç æˆ–æ³¨é‡Šä»£ç æ®‹ç•™
- [ ] æ— å®‰å…¨é£é™©ï¼ˆå¦‚ç¡¬ç¼–ç å¯†é’¥ã€SQL æ³¨å…¥ï¼‰

### ä»£ç å®¡æŸ¥æ£€æŸ¥æ¸…å•

Reviewer å¿…é¡»éªŒè¯ï¼š

- [ ] åŠŸèƒ½å®ç°æ˜¯å¦å®Œæ•´ä¸”æ­£ç¡®
- [ ] ä»£ç æ˜¯å¦æ˜“äºç†è§£å’Œç»´æŠ¤
- [ ] æ˜¯å¦éµå¾ªè®¾è®¡æ–‡æ¡£å’Œç¼–ç è§„èŒƒ
- [ ] æµ‹è¯•è¦†ç›–æ˜¯å¦å……åˆ†
- [ ] æ˜¯å¦æœ‰æ˜æ˜¾çš„æ€§èƒ½é—®é¢˜
- [ ] æ˜¯å¦å¼•å…¥äº†æ–°çš„ä¾èµ–ï¼ˆæ˜¯å¦é€šè¿‡è¯„åˆ†ï¼‰
- [ ] æ–‡æ¡£æ˜¯å¦å®Œæ•´æ›´æ–°
- [ ] æ˜¯å¦å­˜åœ¨å®‰å…¨éšæ‚£

### æ¯å‘¨æ£€æŸ¥æ¸…å•

- [ ] ä¾èµ–æ¼æ´æ‰«æï¼ˆ`dotnet list package --vulnerable`ï¼‰
- [ ] æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Šï¼ˆåº”ä¿æŒ â‰¥ 70%ï¼‰
- [ ] ä»£ç å¤æ‚åº¦åˆ†æï¼ˆæ˜¯å¦æœ‰å‡½æ•°è¶…è¿‡ CC=10ï¼‰
- [ ] æŠ€æœ¯å€ºç§¯å‹ï¼ˆæ˜¯å¦æœ‰å¾…è§£å†³çš„é—®é¢˜ï¼‰
- [ ] æ–‡æ¡£æ˜¯å¦åŒæ­¥

### æ¯æœˆæ£€æŸ¥æ¸…å•

- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•ï¼ˆå†…å­˜ã€CPUã€è½¬æ¢é€Ÿåº¦ï¼‰
- [ ] ä¾èµ–æ›´æ–°æ£€æŸ¥ï¼ˆæ˜¯å¦æœ‰æ–°ç‰ˆæœ¬å¯ç”¨ï¼‰
- [ ] è·¨å¹³å°å…¼å®¹æ€§æµ‹è¯•ï¼ˆWindows / Linux / macOSï¼‰
- [ ] æ–‡æ¡£å®Œæ•´æ€§å®¡æŸ¥
- [ ] æŠ€æœ¯å€ºè¯„ä¼°ä¸ä¼˜å…ˆçº§æ’åº

---

## é™„å½•ï¼šå‚è€ƒèµ„æº

### ç¼–ç¨‹æœ€ä½³å®è·µ

- **Clean Code** - Robert C. Martin
- **Code Complete** - Steve McConnell
- **Refactoring** - Martin Fowler
- **Design Patterns** - Gang of Four

### .NET ç›¸å…³

- [Microsoft Docs: C# Coding Conventions](https://docs.microsoft.com/dotnet/csharp/fundamentals/coding-style/coding-conventions)
- [Roslyn Analyzers](https://github.com/dotnet/roslyn-analyzers)
- [StyleCop.Analyzers](https://github.com/DotNetAnalyzers/StyleCopAnalyzers)

### ç‰ˆæœ¬æ§åˆ¶ä¸åä½œ

- [Semantic Versioning](https://semver.org/)
- [Conventional Commits](https://www.conventionalcommits.org/)
- [Git Flow](https://nvie.com/posts/a-successful-git-branching-model/)

### å®‰å…¨ä¸åˆè§„

- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [CWE Top 25](https://cwe.mitre.org/top25/)
- [NuGet Security Best Practices](https://docs.microsoft.com/nuget/concepts/security-best-practices)

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.2 | **æœ€åæ›´æ–°**ï¼š2025-11-16 15:00 (UTC) | **ç»´æŠ¤è€…**ï¼šå¼€å‘å›¢é˜Ÿ

**v1.2 å˜æ›´æ—¥å¿—**ï¼š
- ğŸ”„ é‡æ„ï¼šæ‹†åˆ† AIMetadataExtractor ä¸ºä¸‰ä¸ªä¸“åŒ–æœåŠ¡ï¼ˆPngMetadataExtractorã€JpegMetadataExtractorã€WebPMetadataExtractorï¼‰
- âœ¨ æ”¹è¿›ï¼šæ¯ä¸ªæ ¼å¼ç°åœ¨æœ‰ç‹¬ç«‹çš„å®ç°ï¼Œé¿å…ç›¸äº’å¹²æ‰°
- âœ¨ æ”¹è¿›ï¼šJPEG å’Œ WebP çš„å…ƒæ•°æ®è¯»å–ç°åœ¨è¿”å›æ­£ç¡®å€¼è€Œéç©ºå€¼
- ğŸ“š æ–°å¢ï¼šConversionService æ·»åŠ æ ¼å¼è·¯ç”±æ–¹æ³•ï¼ˆExtractAIMetadataã€WriteAIMetadataã€VerifyAIMetadataï¼‰
- ğŸ› ä¿®å¤ï¼šJPG/WebP å…ƒæ•°æ®è¯»å–è¿”å›ç©ºå€¼çš„é—®é¢˜

**v1.1 å˜æ›´æ—¥å¿—**ï¼š
- âœ¨ æ–°å¢ï¼šæ—¶é—´æˆ³ä¸æ—¥å¿—è§„èŒƒç« èŠ‚ï¼ˆç¬¬ 11 èŠ‚ï¼‰
- âœ¨ æ–°å¢ï¼šæŠ¥å‘Šå‘½åã€æ—¶é—´æˆ³æ ¼å¼ã€æ—¥å¿—çº§åˆ«è§„èŒƒ
- âœ¨ æ–°å¢ï¼šæ–‡ä»¶æ—¶é—´æˆ³è®¾ç½®çš„å¹³å°å…¼å®¹æ€§è¯´æ˜
- ğŸ› ä¿®å¤ï¼šXLSX å•å…ƒæ ¼è¶…å¤§æ–‡æœ¬å¤„ç†ï¼ˆè‡ªåŠ¨æˆªæ–­>1000å­—ç¬¦ï¼‰
- ğŸ“š æ”¹è¿›ï¼šFileTimeService æ·»åŠ è¯¦ç»†çš„å¹³å°é™åˆ¶æ–‡æ¡£
- âœ… æ›´æ–°ï¼šReportService æ·»åŠ æ—¶é—´æˆ³æ–‡ä»¶åå’Œæ—¥å¿—è®°å½•åŠŸèƒ½

*æœ¬æ–‡æ¡£ä¸ºå›¢é˜Ÿå…±è¯†ï¼Œå¦‚æœ‰æ”¹è¿›å»ºè®®ï¼Œè¯·é€šè¿‡ Issue æˆ– Discussion æå‡ºã€‚*
